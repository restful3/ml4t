# 토폴로지 데이터 분석(TDA)으로 더 똑똑한 주식 포트폴리오 만들기 (Portfolio Construction Using Topological Data Analysis)

## 서론: 왜 새로운 투자 방식이 필요할까?

단순히 SPY ETF를 보유하거나 그 구성 종목에 시가총액 비중대로 투자하는 전략은 시장 전체가 하락할 때 함께 손실을 보는 '상관관계 리스크'에 그대로 노출됩니다. 이 문제를 해결하기 위해, 주식 시장 데이터의 보이지 않는 '모양'과 '구조'를 분석하여 숨겨진 패턴을 찾는 **토폴로지 데이터 분석(Topological Data Analysis, TDA)** 이라는 새로운 접근법이 있습니다. 이 방법의 최종 목표는 서로 상관관계가 낮은 종목들을 효과적으로 묶어 포트폴리오의 안정성을 높이고, 특히 시장 하락 시 발생하는 손실(drawdown)을 줄이는 것입니다.

이 글을 통해 여러분은 TDA의 기본 개념부터 **PCA, UMAP, DBSCAN**과 같은 핵심 기술들이 어떻게 포트폴리오 다각화에 사용되는지 명확하게 이해하게 될 것입니다.

### 1. 토폴로지 데이터 분석(TDA)이란 무엇인가?

**토폴로지 데이터 분석(TDA)** 이란, 데이터의 숨겨진 기하학적 형태와 구조를 분석하는 기술입니다. 이는 마치 안갯속에 가려진 산의 윤곽을 파악하는 것과 같습니다. TDA는 여러 변수가 얽혀있는 고차원의 복잡한 데이터 속에서, 기존 방식으로는 발견하기 어려운 비선형적 관계나 숨겨진 패턴을 찾아내는 데 특히 유용합니다.

TDA의 핵심 도구 중 하나는 **'Mapper 알고리즘'** 입니다. 이 알고리즘은 고차원 데이터를 저차원 공간으로 '투영(projection)'하는 역할을 합니다. 이 과정에서 데이터가 가진 본래의 구조적 특징은 최대한 보존하면서도, 컴퓨터가 분석하기 쉽도록 계산 효율성을 크게 높여줍니다.

그렇다면 TDA는 구체적으로 어떤 기술들을 활용하여 이 복잡한 분석을 수행할까요? 다음 섹션에서 그 핵심 도구들을 하나씩 살펴보겠습니다.

### 2. 포트폴리오 분석을 위한 TDA의 핵심 도구들

TDA를 이용한 포트폴리오 분석 과정은 마치 정교한 퍼즐을 맞추는 것과 같습니다. **PCA, UMAP, DBSCAN**이라는 세 가지 핵심 기술이 각자의 역할을 수행하며 전체 그림을 완성합니다.

* **PCA (주성분 분석, Principal Component Analysis): 데이터 요약** PCA는 복잡하게 얽힌 데이터를 가장 중요한 정보만 남기고 단순화하는 역할을 합니다. 불필요한 노이즈를 제거하고 데이터의 차원을 줄여, 이후 분석 과정의 속도와 정확도를 높이는 필수적인 첫 단계입니다.
* **UMAP (균일 다양체 근사 및 사영, Uniform Manifold Approximation and Projection): 정밀 지도 그리기** PCA를 거쳐 한 번 단순화된 데이터를 더욱 정밀하게 압축하여 저차원 공간에 배치하는 단계입니다. UMAP은 데이터 포인트들 간의 국소적(local) 관계와 전역적(global) 구조를 모두 잘 보존하는 탁월한 능력을 지녔습니다. 이는 주식들 간의 미묘한 관계를 놓치지 않고 정확한 그룹화를 하는 데 필수적입니다.
* **DBSCAN (밀도 기반 군집 분석, Density-Based Spatial Clustering of Applications with Noise): 그룹으로 묶기** UMAP을 통해 저차원 지도에 그려진 데이터 포인트들을 의미 있는 그룹(클러스터)으로 묶는 마지막 단계입니다. 특히 주식 수익률처럼 비슷한 움직임을 보이는 데이터들을 상관관계 기준으로 가까운 그룹으로 묶어주며, 다른 그룹에 속하지 않는 특이점(아웃라이어)들을 노이즈로 잘 구분해내는 장점이 있습니다.

이제 이 세 가지 도구들이 어떻게 순서대로 결합되어 실제 포트폴리오 구성 전략으로 완성되는지 구체적인 프로세스를 통해 알아보겠습니다.

### 3. 단계별 프로세스: 주식 데이터에서 숨겨진 클러스터 찾기

여기서는 SPY 상위 200개 종목의 주가 데이터를 활용하여 어떻게 위험도가 낮은 주식 클러스터를 찾아내고, 이를 바탕으로 안정적인 포트폴리오를 구성하는지 전체 과정을 단계별로 설명합니다.

- **1단계: 데이터 준비 및 차원 축소** 먼저 SPY 내 비중 상위 200개 종목의 일일 로그 수익률 데이터를 준비합니다. 이 고차원 데이터를 **PCA**와 **UMAP**을 차례로 적용하여 분석이 용이한 저차원 공간으로 '투영'합니다. 이 과정은 복잡한 주식 시장의 관계를 한눈에 볼 수 있는 지도를 만드는 것과 같습니다.
- **2단계: 클러스터링 및 구조 시각화** 저차원으로 투영된 데이터에 **DBSCAN** 알고리즘을 '상관관계 거리(correlation distance)' 기준으로 적용합니다. 이를 통해 비슷한 수익률 움직임을 보이는 주식들을 작은 그룹(클러스터)으로 묶습니다. 이 작은 클러스터들은 그래프의 '노드(node)'처럼 작용하며, 서로 상관관계가 높은 클러스터들끼리는 '엣지(edge)'로 연결됩니다. 이렇게 연결된 구조들이 모여 더 큰 클러스터를 형성하고, 이 전체 네트워크가 바로 데이터의 숨겨진 구조를 보여주는 '네트워크 지도(simplicial complex)'가 됩니다.
- **3단계: 포트폴리오 구성** 이렇게 형성된 여러 클러스터들(거대 클러스터와 작은 클러스터)에 자산을 동일한 비중으로 배분합니다. 이 방식은 서로 상관관계가 낮은 그룹들에 자산을 고르게 분산시켜 특정 종목이나 섹터의 갑작스러운 충격이 전체 포트폴리오에 미치는 영향을 최소화합니다. 이것이 바로 '비체계적 위험'을 효과적으로 줄이는 TDA 전략의 핵심입니다.

이론적으로 설계된 이 전략이 과연 실제 시장에서도 효과적이었을까요? 다음 섹션에서 백테스트 결과를 통해 그 성과를 직접 확인해 보겠습니다.

### 4. 결과 분석: TDA 포트폴리오는 정말 효과적이었나?

2020년 3월부터 2025년 3월까지 약 5년간의 데이터를 바탕으로 TDA 포트폴리오 전략을 다른 두 가지 기준 전략과 비교한 결과는 다음과 같습니다.

|지표	|TDA 포트폴리오 (제안)	|상위 200개 종목 (정규화)	|SPY 단순 보유 (기준)|
|---|---|---|---|
|샤프 비율	|0.837	|0.817	|0.807|
|베타	|0.895	|0.926	|1.0|
|최대 손실률	|17.2%	|24.5%	|26.3%|

위 표의 결과는 TDA 포트폴리오의 우수성을 세 가지 측면에서 명확히 보여줍니다.

* **위험 대비 수익 (샤프 비율)**: TDA 포트폴리오의 샤프 비율이 가장 높습니다. 이는 동일한 위험을 감수했을 때 다른 전략들보다 더 높은 초과 수익을 기대할 수 있다는 의미입니다.
* **시장 민감도 (베타)**: 베타 값이 1보다 낮은 0.895를 기록했습니다. 이는 시장 전체(SPY)의 움직임에 덜 민감하게 반응한다는 뜻으로, 특히 시장 하락 국면에서 손실을 방어하는 능력이 더 강하다는 것을 보여줍니다.
* **위험 관리 (최대 손실률)**: 최대 손실률이 17.2%로, 기준이 되는 SPY(26.3%)나 상위 200개 종목 포트폴리오(24.5%)에 비해 현저히 낮습니다. 이는 TDA 전략이 포트폴리오의 안정성을 크게 향상시켰다는 가장 강력한 증거입니다.

전략의 강건성을 평가하기 위해 파라미터 민감도 테스트가 수행되었습니다. 테스트된 변수는 과거 데이터 조회 기간(50주\~350주)과 심플리셜 컴플렉스 재구성 주기(25일\~250일)입니다.

* 총 70개의 파라미터 조합 중 11.4%(8개)가 벤치마크보다 높은 샤프 지수를 기록했습니다.
* 조합의 92.9%(65개)가 벤치마크보다 낮은 베타를 생성했습니다.
* 조합의 57.1%(40) (**원문 오타**)이 벤치마크보다 작은 최대 손실률을 보였습니다.

가장 우수한 위험 조정 수익률을 보이면서도 낮은 손실률과 벤치마크와의 낮은 상관관계를 유지한 과거 데이터 조회 150주와 재구성 주기 125일이 기본 파라미터로 선택되었습니다. 이 파라미터를 적용했을 때 0.018의 알파를 기록하여 TDA와 클러스터링 기법이 벤치마크 대비 초과 수익을 창출할 잠재력이 있음을 보여주었습니다.

이러한 결과들이 퀀트 금융 분야에서 어떤 의미를 가지는지 마지막으로 정리해 보겠습니다.

### 5. 결론: TDA가 제시하는 새로운 가능성

이번 분석을 통해 TDA 기반 포트폴리오 전략이 전통적인 분산투자를 넘어, 데이터의 숨겨진 '구조'를 분석함으로써 더 낮은 상관관계와 높은 안정성을 가진 포트폴리오를 만들 수 있음을 확인했습니다. 단순히 개별 자산의 관계만 보는 것이 아니라, 전체 시장의 복잡한 네트워크 구조를 파악하여 위험을 분산시키는 한 차원 높은 접근법을 제시한 것입니다.

TDA와 같은 고급 데이터 분석 기법의 진정한 가치는 단순한 상관관계 분석으로는 포착하기 어려운 복잡하고 **비선형적인(non-linear)** 관계를 밝혀내는 데 있습니다. 이를 통해 우리는 주식 시장을 더 깊이 이해하고, 더 정교하며 회복력 있는(resilient) 투자 전략을 구축하는 중요한 도구를 얻게 된 것입니다. 이는 앞으로의 퀀트 투자 분야가 나아갈 새로운 가능성을 보여줍니다.
