# 데이터의 숨겨진 모양 찾기 (Topology and data): 위상수학적 데이터 분석 입문

## 1. 시작하며: 왜 데이터의 '모양'을 알아야 할까요?

오늘날 우리가 마주하는 데이터는 과거와는 다른 세 가지 주요 특징을 가집니다. 바로 *대규모성**, **고차원성**, 그리고 많은 **노이즈**입니다. 수백만 개의 행과 수천 개의 열로 이루어진 데이터셋은 더 이상 특별한 일이 아니며, 특히 생물학 데이터처럼 측정 과정에서 노이즈가 많이 섞이는 경우도 흔합니다.

이러한 특징 때문에 우리는 데이터를 한눈에 보거나 직관적으로 이해하기 매우 어렵습니다. 데이터가 3차원을 넘어서는 순간, 우리의 시각화 능력은 한계에 부딪힙니다. 단순히 평균이나 분산 같은 통계적 요약 수치를 계산할 수는 있지만, 그것만으로는 데이터 전체가 어떤 큰 그림을 그리고 있는지, 어떤 숨겨진 구조나 패턴을 가지고 있는지 파악할 수 없습니다. 예를 들어, 당뇨병 환자 데이터가 실제로는 '1형'과 '2형'이라는 두 개의 뚜렷한 그룹으로 나뉜다는 사실은, 단순히 평균 혈당 수치만 봐서는 알 수 없는 질적인 정보입니다.

이러한 문제에 대한 강력한 해결책으로 등장한 것이 바로 데이터의 질적인 '모양'과 '구조'를 분석하는 <b>위상수학(Topology)</b>입니다. 위상수학은 수학의 한 분야로, 공간의 기하학적 속성을 연구하지만, 구체적인 거리나 좌표값에는 덜 민감합니다. 대신 연결성, 구멍의 개수와 같은 질적인 특징에 집중합니다. 이러한 특성은 특히 생물학과 같은 분야에서 빛을 발합니다. 생물학 데이터에서는 측정된 거리 값에 이론적 근거가 부족하거나, 데이터의 좌표 자체가 자연스러운 의미를 갖지 않는 경우가 많기 때문입니다. 위상수학은 이러한 불확실성 속에서도 약간의 노이즈나 측정 오류에 본질적인 구조가 쉽게 변하지 않아, 불완전하고 노이즈가 많은 실제 데이터 분석에 매우 적합합니다.

그렇다면 위상수학은 데이터의 '모양'을 어떻게 수학적으로 표현할까요? 가장 기본적인 아이디어는 '구멍'을 세는 것에서 시작합니다.

## 2. 위상수학의 기본 아이디어: 구멍의 개수 세기

위상수학의 핵심 아이디어는 공간의 양적인 속성(거리, 각도 등)이 아니라, 늘리거나 구부려도 변하지 않는 '공간의 질적 속성'을 연구하는 것입니다. 그중 가장 대표적인 것이 바로 연결성과 구멍의 개수입니다.

예를 들어, 아래의 알파벳 'A'와 'B'를 생각해 봅시다. 두 글자 모두 하나의 덩어리로 '연결되어 있다'는 점은 같습니다. 하지만 우리는 두 모양이 질적으로 다르다는 것을 직관적으로 압니다. 'A'에는 고리 모양의 구멍이 하나 있지만, 'B'에는 두 개가 있습니다. 이 '구멍의 개수'는 모양을 찢거나 붙이지 않는 한 변하지 않는 본질적인 특징입니다.

위상수학은 이러한 아이디어를 수학적으로 정량화하는 도구를 제공합니다. 이러한 구멍을 공식적으로 계산하는 수학적 프레임워크를 <b>호몰로지(Homology)</b>라고 하며, 그 결과로 나오는 것이 바로 <b>베티 수(Betti numbers)</b>입니다. 베티 수는 '고차원 구멍 계수기'라고 생각할 수 있습니다.

* **β0** (베티 0): 데이터가 몇 개의 <b>덩어리(연결 요소)</b>로 나뉘어 있는가?
* **β1** (베티 1): 데이터에 몇 개의 <b>고리 모양 구멍(루프)</b>이 있는가?
* **β2** (베티 2): 데이터에 몇 개의 <b>속이 빈 껍질(void)</b>이 있는가?

위의 예시에 베티 수를 적용하면, 'A'는 β1 = 1이고 'B'는 β1 = 2입니다. 이처럼 베티 수는 두 모양을 질적으로 구별하는 명확한 기준을 제공합니다.

이처럼 도형의 구멍 개수를 셀 수 있다는 것은 알겠습니다. 하지만 흩어져 있는 데이터 포인트들에서 어떻게 이런 '모양'을 만들어낼 수 있을까요?

### 3. 점들을 연결하여 모양 만들기: 단순 복합체

실제 데이터는 위 그림처럼 깔끔한 도형이 아니라, 고차원 공간에 흩뿌려진 점들의 집합(포인트 클라우드)입니다. 위상수학을 적용하려면, 먼저 이 점들로부터 기하학적인 모양을 만들어야 합니다. 가장 직관적인 아이디어는 "가까운 점들을 선으로 연결하고, 서로 가까운 세 점이 있으면 삼각형으로 채운다"는 것입니다.

이렇게 점(0차원), 선(1차원), 삼각형(2차원), 그리고 이를 확장한 고차원 도형(사면체 등)들을 규칙에 맞게 이어 붙여 만든 기하학적 구조를 <b>단순 복합체(Simplicial Complex)</b>라고 부릅니다.

단순 복합체를 만드는 방법은 여러 가지가 있습니다. 이론적으로 가장 정확한 방법 중 하나는 <b>체흐 복합체(Čech complex)</b>입니다. 각 데이터 포인트를 중심으로 하는 공(ball)들이 겹치는 패턴을 기반으로 모양을 만듭니다. 하지만 모든 점들 사이의 복잡한 겹침 관계를 계산해야 하므로 계산 비용이 매우 높다는 단점이 있습니다.

그래서 실제 분석에서는 계산이 훨씬 간단한 근사 방법인 <b>비토리스-립스 복합체(Vietoris-Rips complex)</b>가 널리 사용됩니다. 생성 규칙은 매우 간단합니다.

1. **거리 임계값 ε을 정합니다.** 이 값은 '얼마나 가까워야 이웃으로 간주할 것인가'를 결정하는 기준입니다.
2. **규칙에 따라 점들을 연결합니다.**
  * 두 점 사이의 거리가 ε 이하면, 두 점을 <b>선(edge)</b>으로 연결합니다.
  * 세 점이 쌍으로 모두 ε 이하의 거리에 있다면(즉, 세 점이 삼각형을 이루는 세 개의 선으로 이미 연결되어 있다면), 그 속을 채운 <b>삼각형(triangle)</b>을 만듭니다. 이 규칙은 네 점, 다섯 점 등 고차원으로 확장될 수 있습니다.

이 두 복합체는 Č(X, ε) ⊆ V R(X, 2ε) ⊆ Č(X, 2ε)라는 관계를 통해 서로 연결되어 있어, 비토리스-립스 복합체가 체흐 복합체의 좋은 근사치 역할을 할 수 있음을 보여줍니다. 연구자들은 이론적 정확성과 계산 효율성 사이의 이러한 트레이드오프를 고려하여 적절한 방법을 선택합니다.

하지만 여기서 한 가지 중요한 문제가 생깁니다. 우리가 정하는 거리 임계값 ε에 따라 모양이 완전히 달라지는데, 어떤 값이 '올바른' 값일까요?

### 4. 진짜 특징과 노이즈 구별하기: 영속 호몰로지

임계값 ε을 선택하는 것은 매우 까다로운 문제입니다.

* ε이 너무 작으면, 대부분의 점들이 연결되지 않아 데이터가 여러 조각으로 나뉘고, 샘플링 간격 때문에 생긴 의미 없는 작은 구멍들(노이즈)만 많이 생길 수 있습니다.
* ε이 너무 크면, 모든 점들이 서로 연결되어 중요한 구멍들까지 메워져 데이터의 본질적인 구조를 놓칠 수 있습니다.

<b>영속 호몰로지(Persistent Homology)</b>는 이 딜레마에 대한 강력한 해결책을 제시합니다. 핵심 아이디어는 "하나의 ε 값을 선택하는 대신, ε을 0부터 점차 키워가면서 모양의 변화를 모두 관찰하고, 그 과정에서 오랫동안 '살아남는(persist)' 특징이 진짜"라고 판단하는 것입니다.

이 과정을 시끄러운 원형 데이터 예시로 살펴봅시다. ε 값이 작을 때는 데이터의 큰 원형 구조(‘진짜’ 특징)와 함께 샘플링이 듬성듬성한 곳에 생긴 두 개의 작은 구멍(‘가짜’ 특징)이 함께 나타납니다. ε 값을 조금 더 키우면, 작은 구멍들은 금방 메워져 사라지지만, 큰 원형 구조는 오랫동안 그 형태를 유지합니다. 이처럼 잠시 나타났다 사라지는 특징은 노이즈일 가능성이 높고, 오랫동안 지속되는 특징은 데이터의 본질적인 구조일 가능성이 높습니다.



이 관찰 결과를 시각적으로 요약한 것이 바로 <b>바코드(Barcode)</b>입니다. 바코드는 각 구멍이 언제 나타나서(birth) 언제 사라지는지(death)를 막대그래프로 표현한 것입니다.

|바코드 요소	|의미	|해석|
|---|---|---|
|**긴 막대**	|작은 ε 값에서 나타나서 큰 ε 값까지 오랫동안 '지속(persist)'되는 구멍	|데이터의 핵심적인 구조, '진짜' 특징|
|**짧은 막대**	|특정 ε 값 근처에서 잠시 나타났다가 사라지는 구멍	|샘플링 오류나 노이즈일 가능성이 높음|

결론적으로, 영속 호몰로지는 <b>"막대의 길이가 특징의 중요도를 나타낸다"</b>는 놀라운 통찰을 제공합니다. 우리는 더 이상 최적의 ε 값을 고민할 필요 없이, 바코드에서 가장 긴 막대들에 집중하여 데이터의 가장 중요한 구조적 특징을 발견할 수 있습니다.

이러한 추상적인 개념이 실제 데이터 분석에서는 어떻게 활용될까요? 자연 이미지 데이터를 분석한 흥미로운 사례를 통해 영속 호몰로지의 힘을 직접 확인해 보겠습니다.

### 5. 실제 적용 사례: 자연 이미지의 숨겨진 구조

한 연구팀은 "디지털카메라로 찍은 자연 이미지 속에 숨겨진 수학적 구조는 무엇일까?"라는 질문을 탐구했습니다. 연구팀은 자연 풍경 이미지에서 수백만 개의 작은 3x3 픽셀 패치(총 9개의 픽셀 값으로 구성된 조각)를 추출했습니다.

각 9픽셀 패치는 9차원 공간의 '점' 하나로 볼 수 있습니다. 연구팀은 이 점들을 그대로 사용하지 않고, 먼저 평균 밝기 값을 빼고(mean-centering) 대비(contrast)를 나타내는 D-norm 값으로 정규화하는 전처리 과정을 거쳤습니다. 그 결과, 모든 데이터 포인트들은 8차원 공간(R⁸)에 존재하는 7차원 타원체 위에 놓이게 되었습니다. 이제 이 수백만 개의 고차원 데이터 포인트에 영속 호몰로지를 적용하여 숨겨진 '모양'을 분석했습니다.

분석은 데이터의 밀도를 두 가지 다른 해상도로 나누어 진행되었습니다. 이는 k-최근접 이웃 거리를 이용한 k-codensity라는 밀도 추정 방법을 통해 이루어졌는데, k 값이 크면 거시적이고 부드러운 밀도를, 작으면 미시적이고 세밀한 밀도를 보게 됩니다.

* **거시적 관점 (k=300)**: 데이터를 넓은 시야에서 부드럽게 바라보았을 때, 바코드에는 **하나의 매우 긴 막대**가 나타났습니다. 이는 데이터의 가장 지배적인 구조가 위상수학적으로 <b>하나의 원(a circle)</b>과 같다는 것을 의미합니다. 이미지 패치의 관점에서 이 '원'은 '선형적인 밝기 변화(linear gradients)', 즉 이미지의 한쪽에서 다른 쪽으로 밝기가 부드럽게 변하는 패턴에 해당했습니다.
* **미시적 관점 (k=15)**: 더 세밀한 해상도로 데이터를 살펴보자, 바코드에는 **다섯 개의 긴 막대**가 나타났습니다. 이는 데이터가 더 복잡한 구조, 즉 <b>세 개의 원이 얽혀있는 구조("three-circle model")</b>를 가지고 있음을 시사했습니다. 이 구조는 단순한 선형 변화뿐만 아니라, 다양한 방향과 형태의 패턴을 포함하는 더 복잡한 모양을 나타냅니다.



여기서 연구는 멈추지 않았습니다. 연구팀은 "이 세 개의 원 모델을 뼈대(skeleton)로 포함하는 더 큰 2차원 공간이 존재할까?"라는 더 깊은 질문을 던졌습니다. 그리고 놀랍게도 그 해답을 찾아냈습니다. 바로 <b>클라인 병(Klein bottle)</b>입니다. 클라인 병은 3차원 공간에서는 스스로를 통과하지 않고는 만들 수 없는 기묘한 2차원 도형입니다.



위 그림처럼, 연구팀이 발견한 세 개의 원 구조는 클라인 병을 2차원 평면에 표현했을 때 그 위에 자연스럽게 그려질 수 있었습니다. 이 분석을 통해 "자연 이미지 속 고대비 패치들은 무작위적인 패턴이 아니라, **클라인 병이라는 명확한 위상수학적 구조 위에 집중되어 있다**"는 경이로운 결론을 얻었습니다. 영속 호몰로지는 겉으로 보기에는 무질서해 보이는 데이터 속에서 아무도 예상치 못한 아름다운 기하학적 구조를 발견해낸 것입니다.

### 6. 결론: 데이터의 모양을 보는 새로운 눈

이 문서를 통해 우리는 복잡한 데이터의 '모양'을 이해하는 새로운 여정을 떠났습니다.

1. 우리는 데이터의 질적 특징을 파악하기 위해 **위상수학**의 렌즈를 사용했습니다.
2. 데이터의 구멍 개수를 세는 수학적 프레임워크인 **호몰로지**와 그 결과인 **베티 수**를 배웠습니다.
3. 흩어진 점들을 연결하여 기하학적 모양을 만들기 위해 **단순 복합체**를 구성했습니다.
4. 마지막으로, 수많은 모양들 속에서 진짜 특징과 노이즈를 구별하기 위해 **영속 호몰로지와 바코드**라는 강력한 도구를 사용했고, 실제 이미지 데이터 분석에서 **클라인 병**이라는 놀라운 구조를 발견하는 과정을 살펴보았습니다.

위상수학적 데이터 분석은 단순히 데이터를 몇 개의 숫자로 요약하는 것을 넘어, 데이터 속에 숨겨진 본질적인 구조적 통찰을 제공합니다. 이는 마치 데이터 과학자에게 세상을 보는 새로운 '눈'을 선물하는 것과 같습니다. 데이터 과학의 세계를 탐험하는 여러분에게 이 새로운 관점이 기존의 방법으로는 발견할 수 없었던 흥미로운 발견으로 이어지기를 바랍니다.
