# ch01 Backtesting And Automated Execution

### **[발표자료 PDF 다운로드](./Quant_Trading_System_Blueprint.pdf)**
### **[원본 도서 내용 (한글 번역)](./04_chapter_1_backtesting_and_automated_execution_ko.md)**

## 요약 (Executive Summary)

본 문서는 트레이딩 전략의 개발 및 실행에 있어 필수적인 **백테스팅(Backtesting)**과 **자동 체결(Automated Execution)** 시스템 구축에 대한 심층적인 분석을 제공한다. 백테스팅은 과거 데이터를 통해 전략의 성과를 검증하는 과정으로, 단순한 성과 지표 확인을 넘어 구현 세부 사항 확정, 통계적 유의성 검토, 잠재적 함정 제거를 목적으로 한다.

가장 치명적인 위험은 과거 성과가 미래에 재현되지 않는 것인데, 이는 **선행 편향(Look-ahead bias)**, **데이터 스누핑(Data-snooping)**, **생존 편향(Survivorship bias)** 등 다양한 데이터 처리 오류와 **시장 환경의 변화(Regime shifts)**에서 기인한다. 따라서 성공적인 알고리즘 트레이딩을 위해서는 선형 모델(Linear models) 중심의 단순한 접근 방식, 철저한 통계적 가설 검정, 그리고 백테스팅과 실제 실행이 동일한 소스 코드로 이루어지는 통합 플랫폼 선정이 필수적이다.

![Figure](unnamed.png)

---

## 1. 백테스팅의 중요성과 실행 세부 사항

백테스팅은 단순히 수익률을 계산하는 도구가 아니라, 전략의 가설을 확인하거나 반박하는 '과학적 방법론'의 핵심이다.

* **구현 세부 사항의 확정**: 논문이나 서적에 발표된 전략이라 할지라도 시장가 주문 시점(장 개시 직후 vs 장 종료 직전), 트리거 가격(매수/매도 호가 vs 직전가) 등 미세한 차이에 의해 수익성이 크게 달라진다. 백테스팅을 통해 이러한 세부 사항을 명확히 규정해야 한다.
* **전략의 정제**: 백테스팅 과정을 반복하며 이동평균 기간 조정, 주문 시점 변경 등을 실험함으로써 전략의 위험 대비 수익을 개선할 수 있다.
* **실제 시장 제약 반영**: 공매도 가능 여부(Hard-to-borrow), 시장 폐장 시간의 불일치 등 실제 거래 환경에서 발생할 수 있는 제약 조건을 사전에 파악할 수 있다.

---

## 2. 백테스팅의 주요 함정과 해결 방안

백테스팅 결과가 실제 거래에서 실현되지 않는 'inflated performance(부풀려진 성과)'를 방지하기 위해 다음의 함정들을 경계해야 한다.

### 2.1. 데이터 처리 및 프로그래밍 편향

* **선행 편향 (Look-ahead Bias)**: 미래의 정보를 현재의 매매 신호 생성에 사용하는 오류다. 백테스팅과 실거래 프로그램을 동일하게 유지함으로써 원천적으로 차단할 수 있다.
* **데이터 스누핑 편향 (Data-snooping Bias)**: 무수히 많은 파라미터를 과거 무작위 패턴에 끼워 맞추는 오버피팅(Overfitting) 문제다.
  * **해결책**: 모델을 최대한 단순화하고 파라미터 수를 최소화하며, 선형 모델을 우선적으로 고려한다.
  * **검증**: 표본 외 데이터(Out-of-sample) 테스트, 교차 검증(Cross-validation), 워크 포워드(Walk-forward) 테스트를 실시한다.

### 2.2. 자산별 데이터 왜곡

* **주식 분할 및 배당 조정**: 과거 가격 데이터를 수정(Back-adjustment)하지 않으면 급격한 가격 변동으로 오신호가 발생한다.
* **생존 편향 (Survivorship Bias)**: 현재 상장된 종목만으로 테스트할 경우 상장 폐지된 종목의 손실이 누락되어 성과가 왜곡된다. 반드시 상장 폐지 종목을 포함한 데이터베이스를 사용해야 한다.
* **거래소 가격 차이**: 통합 가격(Consolidated prices) 대신 주 거래소(Primary exchange)의 데이터를 사용해야 실제 경매 가격에 기반한 정확한 테스트가 가능하다.

### 2.3. 선물 및 외환 시장의 특수성

* **선물 연속 월물 (Continuous Contracts)**: 월물 교체(Rollover) 시 발생하는 가격 격차를 처리할 때, '가격 기반 조정'과 '수익률 기반 조정' 중 전략의 특성(스프레드 거래 여부 등)에 맞는 방식을 선택해야 한다.
* **정산가 vs 직전가**: 유동성이 낮은 선물의 경우 비동기적 가격으로 인한 왜곡을 피하기 위해 정산가(Settlement price)를 사용하는 것이 안전하다.
* **외환 시장의 파편화**: 거래소마다 호가와 스프레드가 다르므로, 실제 거래할 플랫폼의 데이터를 사용해야 실질적인 거래 비용 산출이 가능하다.

---

## 3. 통계적 유의성 검정 (Hypothesis Testing)

백테스팅 결과가 단순한 운에 의한 것인지 판단하기 위해 가설 검정 방법론을 도입한다.

| 검정 방식 | 설명 및 특징 |
| --- | --- |
| **가우시안 분포 가정** | 일일 수익률이 정규분포를 따른다고 가정하고 샤프 지수를 이용해 p-value를 계산한다. |
| **몬테카를로 시뮬레이션** | 과거 수익률의 통계적 특성(평균, 표준편차, 왜도, 첨도)은 유지하되 상관관계가 없는 무작위 데이터를 생성하여 전략의 성과와 비교한다. |
| **무작위 거래 시뮬레이션** | 실제 가격 데이터 위에서 매수/매도 시점과 보유 기간만 무작위로 설정한 수만 번의 거래를 실행하여 백테스트 성과가 상위 몇 %에 위치하는지 확인한다. |

---

## 4. 백테스팅 생략 및 예측력 한계 판단

모든 전략을 백테스팅할 필요는 없으며, 다음의 경우 주의가 필요하다.

* **백테스팅을 생략해야 하는 사례**:
  * 수익률은 높지만 샤프 지수가 낮고 최대 낙폭(MDD) 기간이 지나치게 긴 경우.
  * 적절한 벤치마크(예: 롱온리 전략의 경우 매수 후 보유) 대비 우위가 없는 경우.
  * 파라미터가 지나치게 많은 신경망 모델 등 데이터 스누핑이 의심되는 경우.
  * 시장 미시 구조(Microstructure)에 의존하는 고빈도 매매(HFT) 전략(타 참가자의 반응을 예측하기 어려움).
* **예정된 성과 하락 (Regime Shifts)**: 소수점 호가제 도입, 금융 위기로 인한 거래량 급감, 규제 변화(공매도 업틱룰 등)와 같은 시장 구조의 변화는 과거의 수익 모델을 순식간에 무용지물로 만들 수 있다.

---

## 5. 플랫폼 선정 및 자동화 시스템 구축

성공적인 실행을 위해 사용자의 역량과 전략의 복잡도에 맞는 플랫폼을 선택해야 한다.

### 5.1. 플랫폼 유형별 비교

| 플랫폼 유형 | 대표 예시 | 장점 | 단점 |
| --- | --- | --- | --- |
| **특수 목적용 GUI** | Deltix, Apama | 프로그래밍 지식 부족 시 유리, 견고한 인프라 | 전략 표현의 유연성 부족, 높은 비용 |
| **스크립팅 언어** | MATLAB, Python, R | 높은 유연성, 디버깅 용이, 방대한 라이브러리 | 실시간 체결을 위한 추가 API 연결 필요 |
| **범용 언어/IDE** | Java, C++, C# | 최고의 효율성과 제어력, 낮은 지연 시간 | 높은 개발 난이도, 저수준 연결 직접 구현 필요 |

### 5.2. 시스템 구축 시 고려사항

* **코로케이션 (Colocation)**: 지연 시간(Latency)을 줄이기 위해 브로커나 거래소 데이터 센터에 서버를 위치시키는 것이 중요하다. 하지만 클라우드 서버(AWS EC2 등)가 반드시 물리적으로 가깝지 않을 수 있음을 유의해야 한다.
* **멀티쓰레딩 (Multithreading)**: 여러 종목을 동시에 거래할 때 한 종목의 계산이 다른 종목의 주문을 방해하지 않도록 처리해야 한다. MATLAB의 경우 Parallel Computing Toolbox를 사용하더라도 쓰레드 수에 제한이 있다.
* **복합 이벤트 처리 (CEP)**: 이벤트 드리븐(Event-driven) 방식으로 데이터 도착 즉시 반응하는 시스템이다. 복잡한 매매 규칙을 선언적으로 표현할 때 유리하다.
* **통합 환경의 이점**: 백테스팅과 실거래 코드가 동일한 플랫폼(예: TradeLink, Marketcetera 등)을 사용하면 전사(Transcribing) 오류를 방지하고 선행 편향을 자동으로 제거할 수 있다.

---

<div align="center">

[< Previous](../README.md) | [Table of Contents](../README.md) | [Next >](../chapter_2_the_basics_of_mean_reversion/README.md)

</div>
