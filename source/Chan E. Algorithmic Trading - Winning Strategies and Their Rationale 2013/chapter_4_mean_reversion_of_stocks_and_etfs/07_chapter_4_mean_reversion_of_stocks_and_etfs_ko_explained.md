---
lang: ko
format:
  html:
    toc: true
    embed-resources: true
    theme: cosmo
---

# 제4장: 주식과 ETF의 평균 회귀 — 쉬운 해설판

> 이 글은 Ernest Chan의 "Algorithmic Trading" 제4장의 전체 내용을 빠짐없이 담되, 전문 용어와 개념을 일상적인 비유와 풀어쓴 설명으로 재구성한 해설판입니다.

---

## 들어가며: 왜 주식과 ETF에서 평균 회귀를 찾는가?

여러분, 이전 장들에서 우리는 평균 회귀가 무엇인지, 그리고 그것을 어떻게 검정하고 거래하는지 기본기를 배웠습니다. 이제 드디어 **가장 비옥한 토양** — 바로 주식 시장에 발을 딛는 시간입니다.

주식 시장은 어떤 의미에서 평균 회귀 상품을 찾고 이전 두 장에서 설명한 기본 평균 회귀 거래 기법을 적용하기에 가장 비옥한 토양입니다. 왜 그럴까요? 이론적으로 보면, 같은 섹터에 속한 주식 **페어(pair, 짝)**를 구성할 수 있고, 이 두 주식은 비슷한 경제 요인에 노출되어 있으니 **공적분(cointegration)**할 가능성이 있습니다. 게다가 주식 수가 워낙 많으니 분산투자도 쉽죠.

하지만 — 여기서 "하지만"이 나올 줄 예상하셨죠? — 실제로는 주식과 ETF 거래에 이러한 일반적인 기법을 적용하는 데 **몇 가지 심각한 어려움**이 있습니다. 이 장에서는 주식과 ETF에 특정한 문제를 하나하나 검토하고, **간단한 평균 회귀 전략이 실제로 ETF 페어와 트리플렛(3종목 조합)에 더 잘 작동한다**는 것을 직접 시연해 보겠습니다.

### 평균 회귀, 한 가지만이 아니다

그런데 주식이나 ETF에서 평균 회귀를 찾을 때, 반드시 3장에서 배운 전략에만 매달릴 필요는 없습니다. 놀라운 사실 하나: **단기적으로 대부분의 주식은 정상적인 상황에서 평균 회귀 속성을 보입니다.** "정상적인 상황"이란 해당 주식에 특별한 뉴스가 없다는 뜻인데, 이 주제는 7장에서 자세히 다룹니다.

비유를 하나 들어볼까요? 주식 가격이 장기적으로 **기하 랜덤 워크(geometric random walk)** — 술 취한 사람의 걸음처럼 예측 불가능한 방향으로 움직이는 것 — 를 따른다는 것은 잘 알려진 사실입니다. 하지만 그 술 취한 사람도 한 발짝 비틀거리면 균형을 잡으려고 반대쪽으로 기우는 순간이 있잖아요? 그게 바로 **단기적, 또는 "계절적" 평균 회귀**입니다. 이 장에서 이것을 활용하는 전략을 구축할 것입니다.

### 지수 차익거래라는 또 하나의 카드

**지수 차익거래(index arbitrage)**는 또 다른 익숙한 평균 회귀 전략입니다. 이 경우, 주식 대 선물 또는 주식 대 ETF의 공적분에 의존합니다. 마치 백화점에서 파는 선물 세트의 가격과 각각의 물건을 따로 사면 내는 가격의 차이를 노리는 것과 비슷합니다. 전통적인 구현으로는 이익이 거의 남지 않을 정도로 시장이 효율적이 되었기 때문에, 이 장에서는 수정된 전략의 예를 제시합니다.

### 시계열 평균 회귀 vs. 횡단면 평균 회귀

앞서 언급했듯이, 지금까지 주로 다룬 **시계열(time-series) 평균 회귀** 외에도, 주식 바스켓에서 널리 퍼진 **횡단면(cross-sectional) 평균 회귀** 현상이 있습니다. 이 두 가지의 차이를 명확히 해볼까요?

- **시계열 평균 회귀**: 가격이 **자기 자신의 과거 평균**으로 돌아간다. 마치 고무줄에 묶인 공이 원래 위치로 돌아오는 것처럼.
- **횡단면 평균 회귀**: 바스켓 내 개별 상품의 누적 수익률이 **바스켓 전체의 평균 수익률**로 수렴한다. 마치 학급에서 시험을 보면, 한 번 잘 본 학생은 다음에 평균에 가까워지고, 한 번 못 본 학생도 다음에 올라가는 "평균으로의 회귀" 현상처럼.

중요한 포인트: **시계열 평균 회귀에 대한 통계적 검정(ADF, 허스트 지수 등)은 횡단면 평균 회귀에는 대체로 무관합니다.** 별도의 접근법이 필요하다는 뜻이죠. 이 추가적인 유형의 평균 회귀가 존재한다는 것은 주식에서 어떤 종류든 평균 회귀 전략을 만드는 것이 더 쉬워진다는 좋은 소식입니다.

### 통계적 차익거래자들과 수익률 감소

평균 회귀 패턴을 찾기 쉽기 때문에, 주식 시장은 그러한 패턴을 활용하려는 많은 트레이더를 끌어들입니다. 이들은 종종 **통계적 차익거래자(statistical arbitrageurs)**라고 불립니다. 유명한 맛집에 손님이 몰리면 줄이 길어지듯이, 이 전략에 뛰어드는 사람이 많아지면서 **수익률이 일반적으로 감소해 왔습니다.** 이 장에서는 하락하는 성과를 높일 수 있는 몇 가지 간단한 트릭도 논의합니다.

### 백테스팅의 함정 — 반드시 기억하세요

다시 한번 강조하지만, **이 책의 백테스팅 결과에는 거래 비용이 포함되어 있지 않습니다.** 이 누락의 이유는 거래 비용이 사용된 정확한 실행 방법과 주식 모델에 선택된 정확한 주식 유니버스에 상당히 민감하게 의존하기 때문입니다.

주식 모델 백테스팅에 포함된 더 구체적인 함정은 **생존자 편향(survivorship bias)**이 있는 데이터의 사용입니다. 생존자 편향이란 무엇일까요? 현재 살아남아 있는 회사들만 데이터에 포함하고, 도중에 상장 폐지되거나 합병된 회사는 빠지는 것입니다. 마치 동창회에 성공한 사람만 나오는 것과 같죠 — 그래서 "우리 학교 출신은 다 잘 됐네"라고 착각하게 되는 겁니다. 생존자 편향이 없는 데이터는 구성하기 더 번거롭고 비싸기 때문에 자주 사용되지 않지만, 결과가 적어도 지난 1~2년간은 그다지 비현실적이지 않기를 바라는 것입니다.

생존자 편향이 없는 데이터베이스로 백테스트를 다시 하려면, **선택한 주식 지수(일반적으로 S&P 500)도 역사 전체에 걸쳐 구성이 변한다**는 것을 기억해야 합니다. S&P 500의 멤버가 오늘과 10년 전이 같지 않다는 뜻이죠. 이것을 제대로 하려면 **과거 일일 지수 구성을 포함하는 데이터베이스**가 필요합니다.

또한 1장에서 논의한 **기본 거래소 대 통합 주식 가격** 문제도 기억하세요. 여기서 사용된 과거 가격은 모두 **통합 시가와 종가**입니다. 그러나 이러한 전략 중 일부를 **시장가시가주문(MOO, market-on-open)**, **지정가시가주문(LOO, limit-on-open)**, 또는 유사하게 **시장가종가주문(MOC, market-on-close)**, **지정가종가주문(LOC, limit-on-close)**을 사용하여 구현하면, **기본 거래소 시가나 종가에 체결될 것**입니다. 일반적으로, 이것은 실제 수익률이 여기 보고된 것보다 낮을 것임을 의미합니다.

---

## 주식 페어 거래의 어려움 — 쌍둥이도 다른 길을 걷는다

### 왜 이것이 중요한가?

주식 페어 트레이딩은 기관 트레이더가 발명한 **최초의 알고리즘 평균 회귀 전략** 유형으로, 모건 스탠리의 **제리 밤버거(Gerry Bamberger)**가 시작한 것으로 알려져 있습니다 (Patterson, 2010). 월스트리트의 전설적인 전략이었지만, 요즘에는 이 전략에서 수익을 짜내기가 **놀라울 정도로 어려울 수 있습니다.** 왜 그런지 하나하나 살펴볼까요?

### 개별 주식은 평균 회귀하지 않는다

개별 주식의 일일 가격 시계열을 테스트하면, 2장에서 정의한 정상성의 정의를 거의 충족하지 않습니다. **기하 랜덤 워크**가 그들의 행동을 상당히 잘 설명합니다. 비유하자면, 술 취한 사람이 일단 걸어 나가면 시작점으로 돌아오는 경우가 드문 것처럼요. (일중 및 계절적 평균 회귀 속성은 나중에 논의할 특수한 경우입니다.)

### 아웃오브샘플에서 무너지는 공적분

여러분이 어떤 합리적인 방식으로 페어를 만들더라도 — 예를 들어 엑손 대 쉐브론, 또는 씨티뱅크 대 뱅크 오브 아메리카 — **아웃오브샘플(out-of-sample)에서는 거의 공적분하지 않습니다.**

"아웃오브샘플"이란 뭘까요? 과거 데이터로 모델을 만들고, **아직 보지 못한 미래 데이터**에서 검증하는 것입니다. 선택한 기간에서 공적분하는 주식 페어를 찾는 것은 꽤 쉽지만, 이후의 새로운 기간에서 공적분을 쉽게 잃을 수 있습니다.

이 비유로 이해해 보세요: **쌍둥이 형제**가 있다고 합시다. 어릴 때는 키 차이가 거의 없었지만, 한 명이 프로 농구 선수가 되고 다른 한 명이 사무직에 종사하면서 생활 방식이 완전히 달라지면, 체격 차이도 벌어지겠죠? 주식도 마찬가지입니다. **한 회사의 운명이 경영 결정과 경쟁에 따라 매우 빠르게 변할 수 있습니다.** 두 회사가 같은 산업 섹터에 있다는 사실이 같은 운명에 처할 것을 보장하지 않습니다 — AAPL(애플) 대 BBRY(블랙베리)를 떠올려 보세요!

**결론**: 각 회사에 대한 펀더멘털 이해가 있고, 나쁜 뉴스가 공개되기 전에 적시에 포지션을 청산할 수 없다면, 평균 회귀 전략으로 단일 주식 페어 거래에서 **지속적으로 수익을 내기 어렵습니다.**

### 많이 분산하면 해결되지 않을까?

자연스러운 질문이죠. 많은 수의 주식 페어를 거래해서 일부 페어의 간헐적인 탈선이 전체 포트폴리오의 수익성에 영향을 미치지 않게 하면 어떨까?

안타깝지만, **대수의 법칙(law of large numbers)**은 아웃오브샘플 기간에서 개별 페어의 **기대 수익률이 양수**인 경우에만 우리에게 유리하게 작동합니다. 그런데 주식 페어에서 이것이 그렇다는 것을 발견하지 못했다고 합니다. 즉, **"좋은" 페어에서 얻은 작은 이익이 "나빠진" 페어의 큰 손실에 완전히 압도**되었습니다. 열 번 맞추고 한 번 크게 틀리면 전부 날아가는 셈이죠.

### 기술적 어려움 1: 공매도 제약

주식 페어 트레이딩의 근본적인 문제 외에도 두 가지 추가적인 기술적 어려움이 있습니다. 첫 번째는 **공매도 제약(short-sale constraint)**입니다.

공매도란 남의 주식을 빌려서 먼저 팔고, 나중에 싼 가격에 사서 갚는 것이죠. 그런데 빌리기 어려운 주식을 공매도하는 페어에 포지션을 갖는 것은 특히 위험합니다. 왜냐하면, 포지션이 궁극적으로 수익성이 있더라도 **가장 부적절한 시점에 강제 청산**을 당할 수 있기 때문입니다.

구체적인 시나리오를 그려볼까요?

1. 여러분이 어떤 주식을 숏(공매도)하고 있습니다.
2. 그 주식에 예상치 못한 호재가 터지며 가격이 갑자기 상승합니다.
3. 이 주식을 빌려준 사람들이 "나도 팔아서 이익 보고 싶어!"라며 빌려준 주식을 돌려달라고 합니다.
4. 빌린 주식이 회수되면, 지금의 비싼 가격에 사서 갚아야 합니다 — **큰 손실에 포지션을 커버**하면서 다른 레그의 롱 포지션도 매도하게 됩니다.

이것을 **숏 스퀴즈(short squeeze)**라고 합니다. 마치 쥐어짜는 것처럼 숏 포지션을 가진 사람을 강제로 밀어내는 현상이죠.

같은 공매도 제약의 범주에서, 2010년 이후 미국 주식 시장에서 시행 중인 **대체 업틱 규칙(alternative uptick rule)**도 주식 페어 전략의 백테스팅과 라이브 실행 모두에 불확실성을 만듭니다. 이 규칙은 주가가 급락하면 **서킷 브레이커(circuit breaker)**가 발동되어, 본질적으로 숏 시장가 주문을 보내는 것이 금지됩니다.

### 기술적 어려움 2: 일중 거래의 호가 규모 문제

두 번째 어려움은 주식 페어의 **일중 거래**에서 발생합니다. 주식 페어 트레이딩의 이익 마진이 수년에 걸쳐 감소함에 따라, 최적의 가격을 포착하기 위해 일중에 포지션을 진입하고 청산하는 것이 필수적이 되었습니다. 또한, 오버나이트 포지션을 갖지 않으면 장기 포지션을 괴롭히는 기업 펀더멘털 가치 변화를 피할 수 있습니다.

그런데 문제는 주식(및 ETF)에 대한 **전국최우선호가(NBBO, national best bid and offer)** 시세 규모가 매우 작아졌다는 것입니다.

NBBO가 뭔지 간단히 설명하면, 미국의 모든 거래소를 통틀어 **가장 좋은 매수 호가와 매도 호가, 그리고 그 호가에 걸려 있는 물량**을 말합니다. 이 물량이 줄어든 이유는 여러 가지입니다:

- **다크풀(dark pool)** 또는 표시되지 않는 "아이스버그" 주문 사용의 만연 — 큰 주문을 숨기는 것
- 스마트 실행 알고리즘에 의한 대형 주문의 아주 작은 조각들로의 분할
- 자주 취소하고 교체하는 소형 주문을 제출하는 **고빈도 트레이더(HFT)**의 출현
- 고빈도 트레이더에게 이용당하는 것을 피하기 위해 대형 주문 규모를 표시하기 꺼리는 마켓 메이커

예를 들어, **AAPL이 100주의 NBBO 규모만 갖는 것은 드문 일이 아닙니다!** 세계에서 가장 큰 회사 중 하나인 애플인데도 말이죠. 따라서 거래 또는 호가를 사용하여 주식 페어 트레이딩 전략을 백테스팅하는 것은, 100주만 거래하거나 상당한 거래 비용을 포함하지 않는 한 그다지 현실적이지 않습니다.

같은 현상이 라이브 실행에서도 어려움을 초래합니다. NBBO 가격에 의해 거래 신호가 발동된 후 양쪽에 시장가 주문을 제출한다면 상당한 **슬리피지(slippage)** — 원하는 가격과 실제 체결 가격의 차이 — 를 겪을 수 있습니다. 한쪽에 지정가 주문을 보내고 완전히 체결되지 않은 경우 적극적으로 관리해야 합니다.

### 왜 과거에는 수익성이 있었을까?

주식 페어 트레이딩이 과거에 그렇게 수익성이 있었던 한 가지 일반적인 이유는, 당시 시장이 훨씬 더 비효율적이어서 평균 회귀하는 페어에서 얻는 정상적인 이익이 그렇지 않은 페어에서의 손실을 감당하기에 충분히 컸다는 것입니다. 이것은 수익성 있는 전략에 대한 일반적인 재앙이지만 — 사람들이 몰리면 기회가 사라지는 것 — 주식 페어 트레이딩처럼 **잘 알려진 전략에 특히 심각합니다.**

주식 페어 트레이딩의 이익 감소에 대한 구체적인 이유 중 하나는 미국 주식 가격의 **소수점화(decimalization)**입니다. 2001년 이전에는 주식 가격이 1/16 달러 단위로 움직였지만, 소수점화 이후 0.01달러 단위로 바뀌었습니다. 이로 인해 **매수-매도 스프레드가 극적으로 좁아져서**, 일종의 마켓 메이커 역할을 하는 페어 트레이더들의 마켓 메이킹 이익도 감소했습니다 (Serge, 2008).

물론, 미국 시장에서 수익성이 없다는 사실이 **다른 나라에서도 수익성이 없다는 것을 의미하지는 않습니다.** 그러나 미국 시장에서는 대신 **ETF를 수익성 있게 페어 트레이딩할 수 있는 대안**이 있습니다!

---

## ETF 페어(및 트리플렛) 트레이딩 — 과일 바구니끼리의 안정적인 관계

### 왜 ETF가 더 나은가?

주식 페어 대신 **ETF 페어**를 거래하는 것의 핵심 장점은 무엇일까요? 공적분하는 것으로 발견되면, ETF 페어가 **아웃오브샘플 데이터에서 무너질 가능성이 훨씬 적다**는 것입니다.

여기서 우리의 핵심 비유가 등장합니다: **ETF는 과일 바구니**와 같습니다. 하나의 사과(개별 주식)가 상하더라도 바구니 전체의 상태에는 큰 영향이 없죠. **주식 바스켓의 펀더멘털 경제가 단일 회사의 것보다 훨씬 느리게 변하기 때문입니다.** 블랙베리 하나가 망해도 기술 섹터 ETF 전체가 망하진 않잖아요?

### 국가 ETF의 예: EWA와 EWC

예를 들어, 호주와 캐나다 모두 원자재 기반 경제이므로, **EWA**(호주 주식 지수 ETF)와 **EWC**(캐나다 주식 지수 ETF)는 공적분 검정에 좋은 후보입니다. 3장에서 이미 그들의 공적분을 확인했죠. 저자는 2009년에 블로그에서 이 페어를 언급했고 ([http://epchan.blogspot.com/2009/11/in-praise-of-etfs.html?showComment=1257434002472#c1235760260813269054](http://epchan.blogspot.com/2009/11/in-praise-of-etfs.html?showComment=1257434002472#c1235760260813269054)), 글을 쓰는 시점(2012년 11월)까지 그들의 공적분은 계속되었습니다. **3년 이상 지속되는 관계** — 주식 페어에서는 이런 안정성을 기대하기 어렵죠.

### ETF 페어를 찾는 방법

ETF의 페어 선택 과정은 꽤 쉽습니다: **공통 경제 요인에 노출된 ETF**를 찾으면 됩니다. 마치 같은 과일 종류로 구성된 두 개의 바구니를 찾는 것과 같죠.

- **국가 ETF**: 비슷한 경제 구조를 가진 국가들의 ETF (예: 호주 EWA vs. 캐나다 EWC)
- **섹터 ETF**: 비슷한 산업을 추적하는 ETF (예: 소매 펀드 RTH vs. 필수 소비재 펀드 XLP)

다소 같은 섹터를 추적하는 ETF의 수가 증가하면서, **페어 트레이딩 기회도 꾸준히 증가**하고 있습니다.

### 원자재 ETF와 생산자 ETF: GLD 대 GDX의 교훈

저자가 특히 선호하는 또 다른 ETF 페어링은 **원자재 ETF와 그 원자재를 생산하는 회사들의 ETF** 사이입니다. **금 펀드 GLD** 대 **금광 펀드 GDX**가 좋은 예입니다.

논리는 이렇습니다: 금광 회사의 주요 자산이 금이므로, 금광 회사의 가치는 금 현물 가격과 공적분해야 합니다. 비유하면, **개(금광 회사)와 주인(금 가격)이 산책**하는 것처럼 — 개가 앞서거니 뒤서거니 하지만 결국 주인 근처에 머물죠.

그리고 실제로 공적분이 존재했습니다 — **2008년 7월 14일경까지는요.**

- **2006년 5월 23일 ~ 2008년 7월 14일**: 요한센 검정으로 GLD 대 GDX를 테스트하면, **99% 확률로 공적분**
- **2008년 7월 15일 ~ 2012년 4월 9일**: **공적분 상실!**

2008년 7월 14일에 무슨 일이 있었을까요? 그때 유가(웨스트 텍사스 중질유)가 배럴당 약 **\$145로 사상 최고치**를 기록했습니다. 유가가 금 가격과 금광업자 주가 사이의 공적분과 무슨 관련이 있을까요? 분명히 많은 관련이 있습니다! **유가가 비싸면 금을 채굴하는 데 훨씬 더 많은 비용이 들고**, 따라서 금광업자들의 이익이 줄어들어 금 현물 가격에 비해 주가가 저조해집니다 ("The Wacky World of Gold," 2011). 개(금광 회사)가 갑자기 무거운 짐(유가 상승으로 인한 비용)을 지고 걷기 시작한 셈이죠.

### 트리플렛으로 문제 해결하기 — USO를 추가하라

이 설명에 대한 경험적 지지를 수집하기 위해, 포트폴리오에 **오일 펀드 USO**를 도입할 수 있습니다. 그리고 이 **트리플렛(GLD + GDX + USO)**이 2006년부터 2012년까지의 전체 기간에 걸쳐 공적분하는지 확인합니다.

결과: 요한센 검정은 하나의 공적분 관계가 존재할 **99% 확률로 공적분한다**는 것을 보여줍니다! 2종목(페어)으로는 무너졌던 관계가, 3종목(트리플렛)으로 확장하니 회복된 것입니다.

따라서 GLD와 GDX만 거래하는 대신 이 트리플렛 포트폴리오를 거래할 수 있습니다. 트리플렛 거래가 너무 번거롭다고 생각하더라도, 적어도 **유가가 특정 임계값을 초과할 때마다 GLD 대 GDX 거래를 중단하는 규칙**을 갖추어야 합니다.

### 과학적 사고방식의 중요성

이 예는 특별한 의미가 있습니다. 과학자들이 처음 설명되지 않은 현상을 접하면, 그 원인에 대한 직감을 형성한 다음, 이 직감을 경험적으로 테스트할 방법을 찾습니다. **우리도 거래에 접근할 때 같은 과학적 과정을 채택해야 합니다:**

1. 거래 전략이 작동을 멈추면 → **"왜?"라는 가설을 세운다**
2. 그 가설이 데이터로 지지되는지 → **경험적으로 테스트한다**
3. 테스트 결과를 바탕으로 → **수정된 전략을 만든다**

이 과정의 결과는 종종 수익성을 회복하는 수정된 전략입니다. GLD-GDX 페어에서 GLD-GDX-USO 트리플렛으로의 진화가 바로 그 좋은 예입니다.

### USO-XLE 페어의 함정: 선물 펀드의 문제

오일 펀드 USO 대 에너지 섹터 펀드 XLE가 원자재 대 원자재 생산자 페어의 또 다른 예라고 생각할 수 있지만, 이 페어링에는 **중요한 문제**가 있습니다.

**GLD는 실제로 금을 보유**하고 있어 금 현물 가격을 직접 반영합니다. 반면, **USO는 실제로 오일을 보유하지 않습니다.** USO는 **오일 선물 계약**에 투자합니다. 5장에서 자세히 논의하겠지만, 원자재의 선물 가격은 현물 가격과 다릅니다. 따라서 XLE가 오일 현물 가격과 공적분하더라도, USO와 반드시 공적분하지 않을 수 있습니다.

이 문제는 원자재 선물 펀드 대 원자재 생산자 펀드 전반에 적용됩니다. **원자재 펀드가 선물보다 실제 원자재를 보유한다면** 그러한 페어의 평균 회귀 거래가 훨씬 덜 위험할 것입니다.

### ETF 페어 거래의 실무 메커니즘

ETF 페어 거래의 메커니즘은 주식 페어 거래와 기본적으로 동일합니다. 다만 몇 가지 차이점이 있습니다:

- 구 업틱 규칙은 ETF를 면제했지만, 새로운 **대체 업틱 규칙**은 미국 주식 거래소에서 거래되는 모든 증권을 다룹니다.
- 그러나 **ETF의 NBBO 규모는 주식보다 훨씬 큽니다.** 예를 들어, EWC의 NBBO 규모는 약 **5,000주**일 수 있습니다. AAPL의 100주와 비교해 보세요! 50배 차이입니다. 이것이 ETF 페어 트레이딩의 실행이 훨씬 쉬운 이유 중 하나입니다.

---

## 일중 평균 회귀: 갭매수 모델 — 패닉 셀링에서 기회를 잡다

### 왜 이것이 중요한가?

주식 가격은 많은 금융 학자들이 지칠 줄 모르고 상기시키듯이 **기하 랜덤 워크**를 따릅니다 (Malkiel, 2008). 그러나 이것은 가격 시계열을 정기적인 간격(예: 일일 종가 사용)에서 엄격하게 평균 회귀에 대해 테스트할 때만 사실입니다.

트레이더로서 우리의 임무는 **데이터 스누핑 편향을 피하면서 평균 회귀가 규칙적으로 발생하는 특수한 조건이나 특수한 기간**을 찾는 것입니다. 마치 하루 종일 비가 오는 것은 아니지만, 매일 오후 3시에 소나기가 오는 패턴을 발견하는 것과 비슷합니다. 다음 전략이 보여주듯이, 주식에 대해서도 **일중 시간 프레임에서 계절적 평균 회귀**가 발생할 수 있습니다.

### 갭매수 모델의 규칙

전략의 규칙은 다음과 같습니다:

1. **갭 다운 주식 선별**: 전일 저가에서 당일 시가까지의 수익률이 **1 표준편차보다 낮은** 모든 주식을 시장 개장 근처에서 선택합니다. 표준편차는 지난 90일의 일일 종가 대 종가 수익률을 사용하여 계산됩니다. 이것들이 바로 "갭 다운"한 주식들입니다.
2. **모멘텀 필터 적용**: 시가가 종가의 **20일 이동평균보다 높도록** 요구하여 이 주식 목록을 좁힙니다.
3. **상위 10개 선별 및 매수**: 이 목록 내에서 전일 저가에서 가장 낮은 수익률을 가진 **10개의 주식을 매수**합니다. 목록에 10개 미만의 주식이 있으면 전체 목록을 매수합니다.
4. **당일 청산**: 시장 마감 시 **모든 포지션을 청산**합니다.

### 왜 이 전략이 작동하는가?

이 전략의 논리를 일상적인 비유로 풀어보겠습니다:

주식 지수 선물이 개장 전에 하락하는 날에, 특정 주식들이 개장 시 **패닉 셀링(공포 매도)**으로 인해 불균형하게 하락합니다. 마치 백화점 세일 마지막 날에 사람들이 몰려가서 일부 물건이 지나치게 저평가되는 것처럼요. 그러나 일단 이 패닉 셀링이 끝나면, **주식은 하루 동안 점차 상승**할 것입니다.

### 규칙 2의 핵심: 모멘텀 필터

**규칙 2는 평균 회귀 전략에서 종종 매우 유용한 기법입니다.** 이것은 기본적으로 **평균 회귀 전략에 중첩된 모멘텀 필터**로, 앞으로도 자주 사용할 기법입니다.

왜 효과가 있을까요?

- **"약간만" 하락한 주식**은 **"많이" 하락한 주식**보다 반전 가능성이 더 높습니다.
- 많이 하락한 주식은 종종 부정적인 어닝 발표와 같은 **부정적인 뉴스**를 가진 것들이기 때문입니다. 뉴스로 인한 하락은 회귀할 가능성이 적습니다.
- 우리는 실제로 그러한 속보를 기반으로 모멘텀 전략을 개발할 수 있습니다 (7장에서 더 자세히).
- 주식이 장기 이동평균보다 높다는 사실은 **롱온리 펀드 같은 더 큰 플레이어로부터의 매도 압력**을 끌어들이는데, 개장 시 이 유동성 수요가 가격에 대한 하방 압력을 과장합니다.
- **유동성 수요로 인한 가격 움직임**은 수요가 사라질 때 **펀더멘털 변화로 인한 움직임보다 회귀할 가능성이 더 높습니다.**

따라서 이 전략은 전통적인 일간 주식 페어 트레이딩이 실패할 가능성이 있는 **뉴스가 많은 환경에서도 성공**할 수 있습니다.

### 예제 4.1: SPX 주식에 대한 갭매수 모델

이 코드는 갭매수 모델을 백테스트하며 *bog.m*으로 다운로드할 수 있습니다. 세 개의 $T$ $\times$ $N$ 배열 *op*, *lo*, *cl*을 입력으로 필요로 합니다.

- $T$: 일수 (거래일 수)
- $N$: 유니버스의 주식 수
- *op*: 일일 시가(open)
- *lo*: 일일 저가(low)
- *cl*: 일일 종가(close)

백테스트에 사용한 주식 유니버스는 S&P 500이지만, 생존자 편향이 있는 것입니다.

```
topN=10; % Max number of positions
entryZscore=1;
lookback=20; % for MA
stdretC2C90d=backshift(1, smartMovingStd(calculateReturns ...
 (cl, 1), 90));
buyPrice=backshift(1, lo).*(1-entryZscore*stdretC2C90d);
retGap=op-backshift(1, lo))./backshift(1, lo);
pnl=zeros(length(tday), 1);
positionTable=zeros(size(cl));
ma=backshift(1, smartMovingAvg(cl, lookback));
for t=2:size(cl, 1)
       hasData=find(isfinite(retGap(t, :)) & op(t, :) ...
        < buyPrice(t, :) & op(t, :) > ma(t, :));
       [foo idxSort]=sort(retGap(t, hasData), 'ascend');
       positionTable(t, hasData(idxSort(1:\text{min}(topN, ...
        length(idxSort)))))=1;
end
retO2C=(cl-op)./op;
pnl=smartsum(positionTable.*(retO2C), 2);
ret=pnl/topN;
ret(isnan(ret))=0;
```

코드를 한 줄씩 풀어보겠습니다:

- `topN=10`: 최대 10개 종목에 투자
- `entryZscore=1`: 진입 기준이 1 표준편차
- `stdretC2C90d`: 90일간의 종가 대 종가 수익률의 표준편차 (전일 값 사용)
- `buyPrice`: 전일 저가에서 1 표준편차만큼 낮은 가격 = 매수 가격 기준
- `retGap`: 시가와 전일 저가의 갭 수익률
- `ma`: 20일 이동평균 (전일 값 사용)
- for 루프: 갭 수익률이 매수 가격보다 낮고 시가가 이동평균보다 높은 종목을 찾아, 갭이 가장 큰 10개를 선택
- `retO2C`: 시가에서 종가까지의 수익률 = 실제 전략 수익

### 갭매수 모델의 성과

이 전략은 **2006년 5월 11일부터 2012년 4월 24일까지**:
- **연간 수익률(APR)**: 8.7%
- **샤프 비율**: 1.5

누적 수익률 곡선은 그림 4.1에 묘사되어 있습니다.

![](_page_8_Figure_2.jpeg)

**그림 4.1** 갭매수 모델의 누적 수익률

저자는 개인 계좌와 공동 관리한 펀드에서 이 전략의 한 버전을 꽤 수익성 있게 거래했습니다. 불행히도, 그 버전은 **규칙 2(모멘텀 필터)를 포함하지 않았고**, 2009년 이후로 수익률이 감소했습니다. 전략의 롱온리 특성도 일부 리스크 관리 과제를 제시하며, 매일 거래되는 주식 수가 상당히 적어서 전략의 **용량이 크지 않다**는 것을 의미합니다.

### 시가에 진입하는 것이 가능한가?

예리한 독자는 이런 의문을 가질 수 있습니다: "시가에 진입하기 위한 거래 신호를 결정하기 위해 시가를 사용하면서, 동시에 공식 시가에 체결되는 것이 어떻게 가능한가?"

짧은 대답은: **우리는 할 수 없습니다!** 그러나 거래 신호를 결정하기 위해 **사전 개장 가격**(예: ARCA에서의 프리마켓 가격)을 사용할 수 있습니다. 이렇게 결정된 신호는 실제 시가에 의해 결정된 것과 정확히 일치하지 않지만, 그 차이가 수익률을 소멸시킬 정도로 크지 않기를 바랍니다. 이 차이를 **신호 노이즈(signal noise)**라고 부를 수 있습니다.

또한, 1장에서 설명한 것처럼 **통합 가격 대 기본 거래소 가격**을 사용하여 이 전략을 백테스팅하는 함정에 유의해야 합니다.

### 숏 버전: 갭공매도 모델

이 전략의 **거울 이미지(mirror image)**는 어떨까요? 1 표준편차 **갭업**했지만 여전히 20일 이동평균보다 낮은 주식을 숏할 수 있습니다.

결과:
- **APR**: 46%
- **샤프 비율**: 1.27 (같은 기간)

![](_page_9_Figure_2.jpeg)

**그림 4.2** 갭공매도 모델의 누적 수익률

롱온리 전략보다 겉보기에 더 높은 수익률에도 불구하고, 숏온리 전략은 **더 가파른 드로다운**이 있으며, 앞서 논의한 같은 공매도 제약 함정으로 어려움을 겪습니다.

### 다양한 변형들

이 전략은 트레이더들 사이에서 꽤 잘 알려져 있으며, 같은 주제에 많은 변형이 있습니다:

- 롱온리와 숏온리 버전을 **동시에 거래**
- 주식은 롱하고 주식 지수 선물은 숏하는 **헤지 버전** 거래
- 더 많은 수의 주식을 매수하되, 같은 섹터 내의 주식 수를 제한
- 매수 기간을 시장 개장 이후로 연장
- 일중 이익 상한 부과

그러나 **중요한 메시지**는 이것입니다: 일일 봉으로 샘플링했을 때 평균 회귀를 보이지 않는 가격 시계열이 **특정 기간 동안 강한 평균 회귀**를 보일 수 있다는 것. 이것이 짧은 시간 척도에서 작동하는 **계절성(seasonality)**입니다.

---

## ETF와 그 구성 주식 간의 차익거래 — 바구니와 과일의 가격 차이

### 왜 이것이 중요한가?

많은 독자들이 **지수 차익거래(index arbitrage)** 전략에 익숙할 것입니다. 이것은 지수를 구성하는 주식 포트폴리오와 그 지수의 선물 사이의 **가치 차이를 거래**하는 전략입니다.

비유를 들어볼까요? 과일 바구니(ETF)의 가격이 10,000원인데, 바구니 안의 사과, 바나나, 오렌지를 각각 따로 사면 10,500원이라면? 바구니를 사고 과일을 따로따로 팔면 500원 이익이죠. 이것이 지수 차익거래의 기본 원리입니다.

주식이 지수를 구성하는 데 사용된 것과 같은 방식으로 가중치가 적용되면, 포트폴리오의 시장 가치는 지수 선물과 매우 밀접하게 공적분할 것입니다. 아마도 **너무 밀접하게** — 불행히도, 이것은 시장 가치의 차이가 극도로 작아진 매우 잘 알려진 전략입니다 (Reverre, 2001). 가장 정교한 트레이더만이 이 전략에서 이익을 얻을 수 있으며, 확실히 일중에, 아마도 **고빈도(high-frequency)**로 거래해야 합니다 (박스 4.1 참조).

### 해결책: 부분 집합 선택

이 차이를 증가시키기 위해, 지수의 주식 중 **일부만 선택**하여 포트폴리오를 형성할 수 있습니다. 과일 바구니의 모든 과일이 아니라, 특별히 가격 차이가 큰 과일들만 골라 거래하는 셈이죠. 같은 개념은 ETF를 구성하는 포트폴리오와 ETF 자체 사이의 차익거래에도 적용될 수 있습니다.

### 박스 4.1: 고빈도 지수 차익거래

고빈도 트레이더들은 지수의 일중 계산에서 두 가지 결함을 악용하고, 이러한 지수를 추적하는 선물과 구성 주식 사이를 차익거래할 수 있었습니다.

**첫 번째 결함**: 다우존스, S&P, 나스닥, 러셀을 포함한 많은 주요 지수가 **기본 거래소 거래 데이터만** 사용하여 계산됩니다 (기본 대 통합 주식 가격은 1장 참조). 이는 해당 주식에서 거래된 **모든 주식의 30% 미만**을 나타냅니다 (Arnuk and Saluzzi, 2012). 마치 전체 투표 중 30%만 집계해서 선거 결과를 발표하는 것과 같은 불완전함이죠.

**두 번째 결함**: 지수가 **몇 초에 한 번만** 업데이트됩니다. 실시간이 아니라는 뜻입니다.

두 결함 모두 구성 주식 바스켓의 **진정한, 가장 최신 시장 가치와 지수 값 자체 사이의 불일치**로 이어집니다. 결과적으로, 지수 선물 가치는 주식의 순간 시장 가치에 **뒤처질** 것으로 예상할 수 있습니다. 지수 선물 가치가 순간 시장 가치보다 높으면, 단순히 선물을 숏하고 그 반대도 마찬가지입니다.

이 진정한 순간 주식 시장 가치를 어디서 얻을 수 있을까요? 모든 미국 주식 거래소와 ECN(SIAC 피드가 아닌)의 **직접 데이터 피드를 구독**하고 이러한 모든 장소에서 **밀리초 지연**으로 지수의 모든 주식에 대한 거래 가격을 모니터링해야 합니다. 고빈도 거래가 쉽다고 누가 말했나요!

### SPY와 구성 주식 간의 차익거래 전략

이 경우, 구성 주식의 적절한 부분 집합만 선택하여 포트폴리오를 형성합니다. 선택 방법은 다음과 같습니다: **ETF와 개별적으로 공적분하는 모든 주식을 선택**하는 것입니다. 가장 유명한 ETF인 **SPY**를 사용하여 이 방법을 시연합니다.

**단계별 절차:**

1. **훈련 기간 선택**: 1년의 데이터 (2007년 1월 1일 ~ 2007년 12월 31일)
2. **공적분 주식 식별**: 요한센 검정을 사용하여 적어도 90% 확률로 SPY와 공적분하는 모든 주식을 찾음
3. **동일 자본 포트폴리오 구성**: 각 주식에 동일한 자본을 배분하여 포트폴리오 형성
4. **포트폴리오 재검증**: 요한센 검정을 다시 사용하여 이 롱온리 포트폴리오가 여전히 SPY와 공적분하는지 확인

**왜 재검증이 필요한가요?** 각 주식에 동일한 자본 가중치를 임의로 할당한다고 해서 반드시 SPY와 공적분하는 포트폴리오 가격 시계열을 생성하지는 않기 때문입니다. 각각의 부품이 좋다고 조립한 제품이 반드시 좋은 것은 아닌 것처럼요.

이 두 번째 검정에서는 **로그 가격**을 사용하는데, 각 주식의 자본이 일정하도록 매일 이 포트폴리오를 **리밸런싱**할 것으로 예상하기 때문입니다 (3장의 논의 참조).

### 예제 4.2: SPY와 구성 주식 간의 차익거래

이 코드는 *indexArb.m*으로 다운로드할 수 있습니다.

**필요한 입력:**
- $T \times N$ 배열 *cl*: 일일 종가 ($T$는 일수, $N$은 주식 수)
- 셀 배열 *stocks*: 포함된 심볼 목록
- 구조체 *stks*: 위의 배열들을 패키징
- SPY의 일일 종가에 대한 $T \times 1$ 배열 *cl*: 구조체 *etf*에 패키징
- *stks*와 *etf*의 날짜가 일치해야 하며, 공통 거래일은 $T \times 1$ 배열 *tday*에 포함

훈련 세트: 2007년 1월 1일 ~ 2007년 12월 31일

```
trainDataIdx=find(tday>=20070101 & tday<=20071231);
testDataIdx=find(tday > 20071231);
isCoint=false(size(stks.stocks));
for s=1:length(stks.stocks)
       % Combine the two time series into a matrix y2 for
        % input into Johansen test
       y2=[stks.cl(trainDataIdx, s), etf.cl(trainDataIdx)];
       badData=any(isnan(y2), 2);
       y2(badData, :)=[]; % remove any missing data
       if (size(y2, 1) > 250)
            results=johansen(y2, 0, 1); % johansen test
             % with non-zero offset but zero drift, and with
              % the lag k=1.
            if (results.lr1(1) > results.cvt(1, 1))
                 isCoint(s)=true;
            end
       end
end
length(find(isCoint))
```

이 코드를 풀어보면:

- `trainDataIdx`, `testDataIdx`: 훈련/테스트 기간의 인덱스를 분리
- for 루프: S&P 500의 **각 주식에 대해** SPY와의 공적분을 개별 테스트
- `johansen(y2, 0, 1)`: 비영 오프셋, 영 드리프트, 래그 $k=1$로 요한센 검정 수행
- `results.lr1(1) > results.cvt(1, 1)`: 트레이스 통계량이 90% 임계값을 넘으면 공적분으로 판정

결과: 훈련 세트에서 SPY와 (각각 개별적으로) 공적분하는 주식이 **98개** 발견되었습니다!

### 롱온리 포트폴리오의 공적분 검증

이제 SPY와 공적분하는 모든 주식으로 동일한 자본 배분을 가진 롱온리 포트폴리오를 형성하고, 이 포트폴리오와 SPY의 공적분을 테스트합니다.

```
yN=stks.cl(trainDataIdx, isCoint);
logMktVal_long=sum(\text{log}(yN), 2); % The net market value of
 the long-only portfolio is same as the "spread"
% Confirm that the portfolio cointegrates with SPY
ytest=[logMktVal_long, \text{log}(etf.cl(trainDataIdx))];
results=johansen(ytest, 0, 1); % johansen test with non-zero
 offset but zero drift, and with the lag k=1.
prt(results);
% Output:
% Johansen MLE estimates
% NULL: Trace Statistic Crit 90% Crit 95% Crit 99%
% r <= 0 variable 1 15.869 13.429 15.494 19.935
% r <= 1 variable 2 6.197 2.705 3.841 6.635
%
% NULL: Eigen Statistic Crit 90% Crit 95% Crit 99%
% r <= 0 variable 1 9.671 12.297 14.264 18.520
% r <= 1 variable 2 6.197 2.705 3.841 6.635
results.evec
%
```

% ans = % % 1.0939 -0.2799 % -105.5600 56.0933

**요한센 검정 결과 해석:**

트레이스 통계량 15.869가 95% 임계값 15.494를 넘었으므로, 롱온리 포트폴리오가 **95% 이상의 확률로 SPY와 공적분**한다는 것을 나타냅니다. 즉, 주식 포트폴리오와 SPY 사이에 안정적인 장기 관계가 존재합니다.

따라서 주식과 SPY를 모두 포함하는 **롱-숏 정상 포트폴리오**를 형성할 수 있으며, **요한센 고유벡터를 사용하여 SPY 대 주식 포트폴리오의 가중치를 결정**합니다. (실제로 두 개의 공적분 관계가 있지만, **가장 큰 고유값을 가진 것** — 고유행렬의 첫 번째 열 — 을 선택합니다.)

**중요한 포인트:** 요한센 검정이 로그 가격에 대해 수행되었으므로, 주식 또는 SPY에 대한 헤지 비율(*weights* 배열로 표현됨)은 3장에서 설명한 것처럼 **주식 수가 아닌 달러 자본 배분**을 나타냅니다. 각 개별 주식에 대한 가중치는 동일한 자본 배분 가정으로 인해 같지만, SPY에 대한 가중치와는 다릅니다.

### 예제 4.2 (계속): 테스트 기간 적용

그런 다음 예제 2.8과 거의 같은 방식으로 **2008년 1월 2일부터 2012년 4월 9일까지**의 테스트 기간에 걸쳐 이 포트폴리오에 **선형 평균 회귀 전략**을 적용합니다. 포트폴리오 시장 가치의 이동 평균과 표준 편차를 계산하는 데 사용되는 **룩백을 사후에 5로 고정**했습니다.

```
% Apply linear \text{mean}-reversion model on test set
yNplus=[stks.cl(testDataIdx, isCoint), etf.cl(testDataIdx)]; ...
 % Array of stock and ETF prices
weights=[repmat(results.evec(1, 1), size(stks.cl(testDataIdx,
 isCoint))), ...
    repmat(results.evec(2, 1), size(etf.cl(testDataIdx)))]; ...
     % capital allocation among the stocks and SPY.
logMktVal=smartsum(weights.*\text{log}(yNplus), 2); % Log market
 % value of long-short portfolio
lookback=5;
numUnits=-(logMktVal-movingAvg(logMktVal, lookback)) ...
 ./movingStd(logMktVal, lookback);
 positions=repmat(numUnits, [1 size(weights, 2)]).*weights;
 % positions is the dollar capital in each stock or SPY.
pnl=smartsum(lag(positions, 1).*(\text{log}(yNplus)- ...
 lag(\text{log}(yNplus), 1)), 2);
 ret=pnl./smartsum(abs(lag(positions, 1)), 2);
 ret(isnan(ret))=0;
```

코드 해석:

- `weights`: 요한센 고유벡터에 기반한 자본 배분 비율
- `logMktVal`: 롱-숏 포트폴리오의 로그 시장 가치 (= 스프레드)
- `numUnits`: 스프레드의 z-점수에 기반한 포지션 크기 (평균에서 벗어나면 반대 포지션)
- `positions`: 각 주식과 SPY에 대한 실제 달러 포지션
- `pnl`: 일일 손익 계산

### 성과와 한계

이 전략의 성과:
- **APR**: 4.5%
- **샤프 비율**: 1.3

![](_page_14_Figure_3.jpeg)

**그림 4.3** SPY와 구성 주식 간 차익거래의 누적 수익률

누적 수익률 차트에서 볼 수 있듯이, **시간이 지남에 따라 성과가 감소**합니다. 부분적으로는 새로운 헤지 비율로 새로운 구성 주식을 선택하기 위해 모델을 주기적으로 재훈련하지 않았기 때문입니다. 더 완전한 백테스트에서는 이 헤지 비율의 **동적 업데이트**를 추가할 수 있습니다.

같은 방법론은 원하는 모든 ETF, 지수 또는 하위 지수에 적용할 수 있습니다. 또한, 해당 지수를 추적하는 선물이 존재한다면 ETF 대신 선물을 사용할 수 있지만, 이 경우 **백테스트에 사용된 선물 가격이 주식의 종가와 동시적인지** 주의해야 합니다 (1장에서 지적한 잠재적 함정).

### 왜 500개 주식 전체에 요한센 검정을 직접 돌리지 않는가?

당연한 의문이 생길 수 있습니다: SPX의 모든 500개 주식과 SPY에 대해 직접 요한센 공적분 검정을 실행하면 안 되나요? (주식+SPY 유니버스의 모든 공적분 관계가 반드시 SPY를 포함하는 것은 아니지만, SPY를 포함하는 것 하나만 선택하면 됩니다.) 이 접근법의 문제는 두 가지입니다:

1. **기술적 한계**: 알려진 요한센 검정 구현은 **최대 12개의 심볼만** 수용할 수 있습니다 (LeSage, 1998). 500개는 당연히 불가능하죠.
2. **숏 포지션 문제**: 고유벡터는 일반적으로 롱과 숏 **주식** 포지션을 모두 포함합니다. 이것은 숏 SPY 포지션으로 헤지된 주식의 롱온리 포트폴리오를 가질 수 없거나 그 반대도 마찬가지라는 것을 의미합니다. 왜 이것이 문제인가 하면, 주식 포트폴리오에서 숏 포지션과 숏 SPY 포지션을 동시에 가지면 **일부 주식에서 더블 숏**이 되어 특정 리스크가 증가하기 때문입니다.

### 대안적인 방법: 제약 최적화

주식의 롱온리 포트폴리오를 구성하는 대안적인 방법이 있습니다:

1. 여전히 요한센 검정을 사용하여 SPX의 각 주식을 SPY와 개별적으로 테스트합니다.
2. 이 주식 부분 집합을 찾은 후, 주식 포트폴리오에 포함시킵니다.
3. **제약 최적화 방법**(예: **유전 알고리즘(genetic algorithm)** 또는 **시뮬레이티드 어닐링(simulated annealing)**)을 사용하여 주식 포트폴리오 가격 시계열과 SPY 가격 시계열 사이의 **평균 절대 차이를 최소화**합니다.
4. **제약 조건**: 모든 헤지 비율이 양수여야 합니다 (= 롱온리).

MATLAB Global Optimization Toolbox가 이 작업을 위한 함수를 제공합니다.

이 전략은 숏 주식 포지션을 포함하는 모든 전략을 괴롭히는 같은 공매도 제약으로 어려움을 겪습니다. 그러나 주식 포트폴리오가 **약 98개의 주식으로 상당히 분산**되어 있기 때문에 문제가 그다지 심각하지 않습니다. 공매도 제약으로 인해 몇 개의 주식을 제거해야 한다면, 영향은 제한적일 것입니다.

---

## 횡단면 평균 회귀: 선형 롱-숏 모델 — 반에서 꼴찌가 다음 시험에 오른다?

### 시계열 전략과의 차이

공적분에 기반한 평균 회귀 거래에서, 우리는 **고정된 상품 세트와 각 상품에 대해 고정된 주식 수 또는 고정된 달러 자본**으로 포트폴리오를 형성합니다. 이 고정된 수는 명령(예제 4.2에서처럼), 선형 회귀, 요한센 검정 또는 제약 최적화에 의해 결정될 수 있습니다.

그러나 포트폴리오가 매일 같은 고정된 상품 세트 또는 같은 가중치로 구성되어야 할 이유는 없습니다. 많은 포트폴리오 주식 거래 전략의 경우, **에지(edge, 우위)는 정확히 주식의 지능적인 일일 선택 또는 재가중**에서 나옵니다.

### 횡단면 평균 회귀란?

이러한 유형의 소위 **횡단면(cross-sectional) 평균 회귀** 전략에서, 개별 주식(그리고 이 유형의 전략은 가장 일반적으로 선물이나 통화가 아닌 주식을 포함합니다) 가격은 반드시 자체 과거 평균으로 회귀하지 않습니다. 그보다는 **단기 상대 수익률**에 초점을 맞추고, 이러한 상대 수익률의 **직렬 역상관(serial anti-correlation)**에 의존하여 수익을 창출합니다.

학교 비유를 다시 들어볼까요? 시험에서 반 평균보다 훨씬 잘 본 학생은 다음 시험에서 상대적으로 떨어지고, 반 평균보다 훨씬 못 본 학생은 다음 시험에서 상대적으로 올라가는 현상 — 이것이 바로 횡단면 평균 회귀입니다.

대부분의 경우, **상대 수익률**은 주식의 수익률에서 특정 유니버스의 모든 주식의 **평균 수익률을 뺀 것**으로 계산됩니다. 따라서 주식의 저성과가 과성과에 의해 뒤따르고, 그 반대도 마찬가지일 것으로 예상합니다.

중요한 점: 상대 수익률만 측정하므로, **이전 (절대) 수익률이 음수이더라도** 유니버스의 모든 주식의 평균 수익률만큼 음수가 아니면 주식을 숏할 수 있습니다.

### 횡단면 전략의 특이한 특징

횡단면 전략의 한 가지 흥미로운 특징은, "시계열" 전략과 대조적으로 **모든 개별 주식에서 수익을 기대해서는 안 된다**는 것입니다. 일부는 어떤 날에는 **"헤지" 역할**을 할 수 있기 때문입니다. 마치 야구팀에서 모든 선수가 매 경기 홈런을 칠 필요 없이, 팀 전체로 승리하면 되는 것과 같습니다. **수익은 모든 주식에 걸쳐 집계해서만 얻을 수 있습니다.**

### 칸다니-로 전략: 수식 해설

저자는 이전 책에서 칸다니와 로(Khandani and Lo)가 제안한 전략을 설명한 바 있습니다 (Chan, 2009의 예제 3.7; 원 논문은 Khandani and Lo, 2007). 이 전략으로, S&P 500, S&P 1500 또는 Russell 2000과 같은 선호하는 지수의 **모든 주식에 투자하되, 주식당 다른 자본 배분으로 투자**합니다.

매일 장 마감 가까이에, $i$번째 주식에 배분된 롱 또는 숏 자본 $w_i$를 다음과 같이 결정합니다:

$$w_i = -\frac{r_i - \langle r_j \rangle}{\sum_k |r_k - \langle r_j \rangle|} \qquad (4.1)$$

이 수식을 하나하나 뜯어보겠습니다:

**변수 설명:**
- $w_i$: $i$번째 주식에 배분되는 자본 비중 (양수면 롱, 음수면 숏)
- $r_i$: $i$번째 주식의 일일 수익률
- $\langle r_j \rangle$: 지수에 있는 모든 주식의 **평균 일일 수익률** (모든 주식의 수익률 평균)
- $\sum_k |r_k - \langle r_j \rangle|$: 모든 주식의 수익률과 평균의 **절대 차이의 합** (정규화 계수)

**직관적 해석:**

- 분자 $r_i - \langle r_j \rangle$: 주식 $i$가 평균 대비 얼마나 잘 했는가 (또는 못 했는가)
- **마이너스 부호(-)**: 잘 한 주식은 숏하고, 못 한 주식은 롱한다 = **역추세 베팅**
- 분모: 전체 포지션 크기를 정규화하여 **매일 같은 총 총자본 \$1을 투자**

다시 말해, 주식이 동료에 비해 매우 양의 수익률을 가지면 **많이 숏**하고, 동료에 비해 매우 음의 수익률을 가지면 **많이 매수**합니다. 오늘 반에서 1등 한 학생은 내일 떨어질 것이고, 꼴찌는 내일 올라갈 것이라는 베팅인 셈이죠.

### 예제 4.3: 주식에 대한 선형 롱-숏 모델

MATLAB에서 식 4.1의 구현은 매우 간결합니다. 일일 종가의 $T$ $\times$ $N$ 배열 *cl*을 입력으로 가정합니다 ($T$는 거래일 수, $N$은 SPX의 주식 수). 이 코드는 *andrewlo_2007_2012.m*으로 다운로드할 수 있습니다.

```
ret=(cl-lag(cl, 1))./lag(cl, 1); % daily returns
marketRet=smartmean(ret, 2); % equal weighted market index
 % return
weights=-(ret-repmat(marketRet, [1 size(ret, 2)]));
weights=weights./repmat(smartsum(abs(weights), 2), ...
 [1 size(weights, 2)]);
dailyret=smartsum(backshift(1, weights).*ret, 2); % Capital
 % is always one
```

코드 해석:

- `ret`: 각 주식의 일일 수익률 계산
- `marketRet`: 모든 주식의 동일가중 평균 수익률 = $\langle r_j \rangle$
- `weights`: 식 4.1의 분자 (마이너스 부호 포함)
- `weights` 정규화: 분모로 나누어 총 자본이 \$1이 되도록
- `dailyret`: 전일 가중치로 오늘의 수익률 계산 (1일 래그 적용)

### 놀라운 성과

SPX에서 백테스트한 결과, **2007년 1월 2일부터 2011년 12월 30일까지**:

- **APR**: 13.7%
- **샤프 비율**: 1.3

(일반적으로 더 작은 시가총액 유니버스에서 백테스트하면 더 높은 수익률을 생성합니다.)

![](_page_17_Figure_3.jpeg)

**그림 4.4** 선형 롱-숏 모델의 누적 수익률

이 전략의 주목할 만한 특징:

- **완전히 선형** — 복잡한 비선형 모델이 아닙니다
- **매개변수가 없음** — 튜닝할 것이 하나도 없습니다!
- **거의 완벽하게 달러 중립** — 롱과 숏 포지션의 달러 가치가 거의 같습니다

이보다 더 간단한 전략이 있을까요? 그런데도 놀랍게도:
- **2008년** (리먼 브라더스 파산): **APR 30%**
- **2011년** (미국 연방 부채 등급 하향, 그리스 디폴트 불안): **APR 11%**

2008년 초부터의 성과는 전략이 2007년에 발표되었으므로 **진정한 아웃오브샘플 테스트**입니다.

### 일중 버전으로의 업그레이드

이전 책에서 저자는 전일 종가에서 당일 시가까지의 수익률을 사용하여 시가 진입을 위한 가중치를 결정함으로써 이 전략의 수익률을 향상시킬 수 있다고 제안했습니다. 모든 포지션은 장 마감 시 청산되므로 **일중 전략**으로 전환됩니다.

### 예제 4.4: 주식에 대한 일중 선형 롱-숏 모델

예제 4.3에서 필요한 입력 외에도, 주식의 일일 시가를 포함하는 $T$ $\times$ $N$ 배열 *op*도 필요합니다.

```
ret=(op-backshift(1, cl))./backshift(1, cl); % daily returns
marketRet=smartmean(ret, 2); % equal weighted market index
 % return
weights=-(ret-repmat(marketRet, [1 size(ret, 2)]));
weights=weights./repmat(smartsum(abs(weights), 2), ...
 [1 size(weights, 2)]);
dailyret=smartsum(weights.*(cl-op)./op, 2) ...
 ./smartsum(abs(weights), 2);
```

**핵심 차이점:**
- `ret`이 이제 전일 종가에서 당일 시가까지의 수익률 (밤새 수익률)
- 포지션 진입은 시가, 청산은 종가 → **시가~종가 수익률**로 PnL 계산

### 일중 버전의 성과

같은 기간에 걸쳐:
- **APR**: 73%
- **샤프 비율**: 4.7

겉보기에 뛰어난 성과이지만, 시가-종가 버전은 종가-종가 버전에는 없는 **몇 가지 단점**이 있습니다:

1. **거래 비용 2배**: 하루에 한 번이 아닌 **두 번 거래**하기 때문 (백테스트에 미포함)
2. **신호 노이즈**: 시가 진입을 위한 거래 신호를 결정하기 위해 "시가"를 사용해야 하므로, 예제 4.1의 갭매수 모델에서 언급한 것과 같은 거래 신호 노이즈에 영향을 받습니다

실제로, 종가-종가 전략의 경우에도 정확한 종가를 사용하여 가중치를 결정한 다음 정확히 그 가격에 진입할 수 없습니다. 그러나 그 경우, **종가 직전 몇 초의 가격은 일반적으로 실제 공식(기본 거래소) 종가에 훨씬 더 가깝습니다.** 이러한 사전 종가 가격은 기본 시장이 열려 있고 유동성이 높을 때 인쇄되기 때문입니다.

### P/E 비율과 같은 다른 팩터 활용

예제 4.3과 4.4에서 사용한 상대 수익률보다 주식 가격의 횡단면 평균 회귀를 **더 잘 예측하는 다른 변수(또는 "팩터"라고도 함)가 있을 수 있습니다.** 트레이더가 주식을 순위 매기는 데 사용하는 인기 있는 변수 중 하나는 **주가수익비율(P/E ratio, price-to-earnings ratio)**입니다.

여기서 "수익"은:
- 지난 분기의 **실제 수익**, 또는
- 분석가나 회사 자체가 추정한 **예상 수익**

**논리**: 어닝 발표나 추정 변경이 있으면 주가가 새로운 균형 가치로 이동할 것입니다. 따라서 어닝 추정치에 긍정적인 변화를 경험한 주식은 양의 수익률을 누릴 가능성이 높으며, 이 수익률이 어닝 추정치의 변화율과 일치한다면 **가격이 평균 회귀할 것으로 기대해서는 안 됩니다.** P/E 비율을 사용하여 주식을 순위 매기면, 펀더멘털 변화에 의해 정당화된 가격 움직임을 가진 주식을 숏하는 것을 **피할 수 있습니다.**

---

## 핵심 포인트 — 이 장에서 꼭 기억해야 할 것들

이 장의 내용을 정리하면 다음과 같습니다:

- **주식 페어 트레이딩의 유혹과 함정**: 선택의 폭이 엄청나기 때문에 주식 페어를 거래하고 싶은 유혹이 있지만, 뛰어난 백테스트 결과에도 불구하고 아웃오브샘플 성과를 상당히 저조하게 만들 수 있는 **회사 펀더멘털의 변화**에 주의하세요.

- **ETF가 더 낫다**: 공적분 ETF 포트폴리오 거래가 주식 페어 트레이딩보다 나을 수 있습니다. 과일 바구니가 개별 과일보다 안정적인 것처럼요.

- **선물 ETF 주의**: 선물을 보유하는 ETF를 페어 트레이딩하고 있다면, 선물의 총 수익률을 결정하는 **롤 수익률(roll return)**의 역할에 주의하세요.

- **계절적 평균 회귀의 힘**: 계절적 또는 일중 평균 회귀는 일반적인 정상성이나 공적분 검정으로 감지하기 어렵지만, **매우 수익성이 있을 수 있습니다.**

- **모멘텀 필터의 가치**: 평균 회귀 전략에 모멘텀 필터를 부과하면 일반적으로 일관성이 향상됩니다. 너무 많이 하락한 것(뉴스가 있을 수 있는 것)은 피하고, 적당히 하락한 것에 베팅하세요.

- **지수 차익거래의 변형**: 주식과 선물 사이의 지수 차익거래가 더 이상 수익성이 없다고 생각한다면, **지수의 주식 부분 집합만 선택**해 보세요.

- **횡단면 평균 회귀의 단순함**: 횡단면 평균 회귀 전략은 **선형 롱-숏 전략으로 매우 쉽게 구현**할 수 있으며, 매개변수조차 필요 없습니다.

- **다양한 팩터 활용**: 횡단면 평균 회귀 전략에서 주식 순위 매기기에 사용되는 변수는 일반적으로 상대 수익률이지만, **P/E 비율과 같은 다른 펀더멘털 팩터**일 수도 있습니다.

---

## 용어 사전 (Glossary)

| 번호 | 한국어 용어 | English | 정의 |
|------|------------|---------|------|
| 1 | **평균 회귀** | Mean Reversion | 가격이나 수익률이 장기 평균으로 돌아가는 경향. 고무줄에 묶인 공처럼 멀리 갈수록 강하게 끌려옴. |
| 2 | **공적분** | Cointegration | 두 개 이상의 비정상 시계열이 선형 결합하면 정상적(안정적)이 되는 관계. 개와 주인의 산책처럼 각자 방향은 불규칙하지만 서로 멀어지지 않음. |
| 3 | **ETF (상장지수펀드)** | Exchange-Traded Fund | 주식 바스켓을 하나의 상품으로 묶어 거래소에서 주식처럼 거래하는 펀드. 과일 바구니처럼 다양한 종목을 한 번에 보유. |
| 4 | **횡단면 평균 회귀** | Cross-Sectional Mean Reversion | 바스켓 내 개별 상품의 수익률이 바스켓 전체 평균으로 수렴하는 현상. 반에서 1등과 꼴찌가 다음 시험에서 평균에 가까워지는 것과 유사. |
| 5 | **기하 랜덤 워크** | Geometric Random Walk | 가격 변동이 이전 가격에 비례하여 무작위로 움직이는 모델. 술 취한 사람의 걸음처럼 예측 불가. |
| 6 | **숏 스퀴즈** | Short Squeeze | 공매도자가 가격 상승으로 인해 포지션을 강제로 청산당하는 현상. 빌린 주식이 회수되면서 비싼 가격에 사야 하는 상황. |
| 7 | **생존자 편향** | Survivorship Bias | 현재 살아남은 종목만으로 분석하여 결과가 과도하게 좋아 보이는 통계적 편향. |
| 8 | **전국최우선호가 (NBBO)** | National Best Bid and Offer | 미국 전체 거래소를 통틀어 가장 좋은 매수/매도 호가와 그 물량. |
| 9 | **슬리피지** | Slippage | 원하는 가격과 실제 체결 가격의 차이. 거래 비용의 숨은 요소. |
| 10 | **소수점화** | Decimalization | 주식 가격 표시를 분수에서 소수점으로 바꾼 것. 스프레드를 좁히고 마켓 메이킹 이익을 줄임. |
| 11 | **요한센 검정** | Johansen Test | 여러 시계열 간의 공적분 관계를 검정하는 통계적 방법. 트레이스 통계량과 고유값 통계량을 사용. |
| 12 | **갭 (갭업/갭다운)** | Gap (Gap Up/Gap Down) | 전일 종가 또는 저가와 당일 시가 사이의 불연속적인 가격 점프. |
| 13 | **모멘텀 필터** | Momentum Filter | 추세 방향과 일치하는 거래만 허용하는 조건. 평균 회귀 전략에 결합하면 뉴스로 인한 가격 변동을 필터링. |
| 14 | **다크풀** | Dark Pool | 주문 정보가 공개되지 않는 비공개 거래소. 대형 기관 투자자들이 시장 충격 없이 거래하기 위해 사용. |
| 15 | **트리플렛** | Triplet | 3개의 종목으로 구성된 거래 포트폴리오. 페어보다 더 안정적인 공적분 관계를 형성할 수 있음. |
| 16 | **선형 롱-숏 모델** | Linear Long-Short Model | 상대 수익률에 기반하여 매수/매도 비중을 선형적으로 결정하는 전략. 매개변수 없이 구현 가능. |
| 17 | **통계적 차익거래** | Statistical Arbitrage | 통계적 관계에 기반하여 가격 괴리를 이용하는 거래 전략의 총칭. |
| 18 | **주가수익비율 (P/E)** | Price-to-Earnings Ratio | 주가를 주당 순이익으로 나눈 비율. 주식이 수익 대비 얼마나 비싼지를 나타냄. |
