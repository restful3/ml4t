# UMAP: 데이터의 숨겨진 지도를 그리는 방법 (Uniform Manifold Approximation and Projection for Dimension Reduction)

## 1. 차원 축소: 왜 데이터의 '지도'가 필요한가요?

데이터 과학의 세계에서 우리는 종종 수백, 수천 개의 특성(차원)을 가진 데이터를 마주합니다. 이렇게 차원이 높은 데이터는 '차원의 저주'라는 문제에 빠지기 쉽습니다. 데이터 포인트들이 서로 너무 멀리 흩어져 있어 관계를 파악하기 어렵고, 시각적으로 이해하는 것은 거의 불가능합니다.

<b>차원 축소(Dimension Reduction)</b>는 이러한 문제를 해결하기 위한 핵심 기술입니다. 마치 넓고 복잡한 세상을 한눈에 볼 수 있는 지도로 만드는 것처럼, 고차원 데이터를 우리가 쉽게 이해할 수 있는 저차원(주로 2차원 또는 3차원 시각화를 위해 사용되지만, 더 높은 차원으로도 임베딩 가능합니다) 공간에 표현하는 과정입니다.

수많은 '지도 제작' 도구 중에서 <b>UMAP(Uniform Manifold Approximation and Projection)</b>은 현대 데이터 과학에서 가장 주목받는 알고리즘 중 하나로 자리 잡았습니다. UMAP은 저명한 선배 격인 t-SNE의 아이디어 위에 구축되었지만, 데이터의 국지적인 '도시' 구조뿐만 아니라 전체적인 '대륙' 구조까지 보존하는 데 결정적인 이점을 제공하며, 동시에 훨씬 빠른 속도로 실행됩니다. 이러한 장점 덕분에 UMAP은 이미 생물정보학, 재료 과학, 머신러닝 등 다양한 분야에서 널리 사용되고 있습니다.

이제부터 UMAP이 어떻게 이 놀라운 지도 제작을 수행하는지 그 원리를 함께 살펴보겠습니다.

## 2. UMAP의 핵심 아이디어: 두 단계 지도 제작법

UMAP의 작동 원리는 크게 두 가지 핵심 단계로 나눌 수 있습니다. 이는 마치 새로운 세계의 지도를 그리는 과정과 같습니다.

- **1단계: 원본 데이터 세계에서 관계망 구축하기**
  * 먼저 고차원의 원본 데이터가 흩어져 있는 공간을 탐험합니다. 각 데이터 포인트(지점)들이 서로 얼마나 가깝고 누가 누구와 이웃인지를 파악하여, 점들 사이의 관계를 나타내는 정교한 **'위상적 구조(Topological Structure)'**, 즉 관계망을 만듭니다.
- **2단계: 평면 지도 위에 관계망 재현하기**
  * 다음으로, 1단계에서 만든 복잡한 관계망을 **최대한 그대로 유지**하면서, 우리가 볼 수 있는 2차원의 평평한 지도 위에 점들을 다시 배치합니다. 이 과정에서 점들을 움직여가며 최적의 위치를 찾습니다.

**이 두 단계의 최종 목표는 '고차원 세계에서의 관계'를 '저차원 지도'에 최대한 손실 없이 충실하게 옮겨 담는 것입니다.**

## 3. 1단계: 원본 세계의 '위상 지도' 그리기 (Fuzzy Topological Representation)

UMAP의 첫 번째 단계는 원본 데이터의 본질적인 구조, 즉 '위상 지도'를 만드는 것입니다. 이 과정은 다음과 같은 세부 단계로 이루어집니다.

1. **가장 가까운 이웃 찾기** UMAP은 각 데이터 포인트에서 출발하여, 가장 가까운 k개의 이웃을 찾는 것으로 시작합니다. 이는 마치 지도를 그리기 위해 각 도시의 '주변 동네'부터 파악하는 것과 같습니다. 이 k값은 사용자가 지정하는 중요한 하이퍼파라미터입니다.
2. **'상대적 거리' 개념 도입** 모든 점에 동일한 자를 들이대는 대신, UMAP은 각 점마다 자신만의 '거리 기준'을 갖게 합니다.
  * 데이터가 **빽빽한** 곳에서는 거리를 **깐깐하게** 측정합니다. (조금만 멀어도 관계가 멀다고 판단)
  * 데이터가 **듬성듬성한** 곳에서는 거리를 **너그럽게** 측정합니다. (꽤 멀리 있어도 가깝다고 판단)
3. 이처럼 각 점의 주변 환경에 맞춰 거리를 '상대적으로' 조절함으로써, UMAP은 실제 데이터가 불균일하더라도 '데이터가 균일하게 분포한다'는 핵심적인 이론적 가정을 더 유효하게 만들도록 공간을 효과적으로 재구성합니다.
4. **연결 강도를 '확률'로 표현하기 (Fuzzy Simplicial Sets)** '퍼지 심플리셜 집합(Fuzzy Simplicial Sets)'이라는 어려운 용어가 등장하지만, 핵심은 간단합니다. UMAP은 두 점의 관계를 '연결되었다(1)' 또는 '연결되지 않았다(0)'로 단정 짓지 않습니다. 대신, 그 사이에 '애매모호함'을 인정하는 유연한 연결망을 만듭니다. 즉, 두 점이 연결될 **확률** 또는 **멤버십 강도**를 0과 1 사이의 값으로 부여합니다.
5. **로컬 뷰를 하나로 합치기** 각 점에서 바라본 '로컬 관계망'들은 서로 기준이 달라 충돌할 수 있습니다. 예를 들어, A는 B를 가까운 친구로 생각하지만, B는 A를 그냥 아는 사이로 생각할 수 있습니다. UMAP은 이 모든 로컬 뷰를 하나로 합쳐 전체 데이터에 대한 일관된 '위상 지도'를 완성합니다. 이 과정은 "네가 나를 친구라고 생각할 확률과 내가 너를 친구라고 생각할 확률을 모두 고려하여 둘 사이의 최종적인 관계 강도를 설정"하는 방식으로 이루어집니다.

## 4. 2단계: 저차원 지도 위에 점 뿌리기 (Graph Layout)

이제 고차원에서 만든 정교한 '위상 지도'를 2차원 평면에 시각화할 차례입니다. UMAP은 이 과정을 물리학의 <b>'인력(Attractive Force)'</b>과 **'척력(Repulsive Force)'** 원리를 이용해 매우 직관적으로 해결합니다.

1. **초기 배치** 먼저 2차원 공간에 모든 데이터 포인트를 무작위로 뿌려놓거나, '스펙트럼 임베딩(Spectral Embedding)'이라는 방법을 사용해 시작합니다. 이 초기 배치는 임의적인 것이 아닙니다. 그래프의 전체적인 구조를 사용하여 점들에게 합리적인 시작 위치를 부여하는데, 이것이 바로 UMAP이 종종 다른 방법들보다 '큰 그림'을 더 잘 보존하는 핵심적인 이유 중 하나입니다.
2. **힘의 원리로 최적화하기** 그다음, 점들 사이에 힘이 작용하는 시뮬레이션을 시작합니다.
  * **강한 인력 (Attractive Force)**: 1단계의 '위상 지도'에서 **연결 강도가 높았던** (친할 확률이 높았던) 점들 사이에는 강한 고무줄을 연결해 서로 **강하게 잡아당기게** 합니다.
  * **약한 척력 (Repulsive Force)**: 반대로, **연결 강도가 낮거나 없었던** 점들 사이에는 서로를 **살짝 밀어내는** 약한 자석을 둡니다. 이는 점들이 한곳에 겹쳐 뭉치는 것을 방지합니다. 이 과정을 모든 점들 쌍에 대해 계산하지 않고 효율적으로 수행하기 위해, UMAP은 '네거티브 샘플링'이라는 영리한 전략을 사용합니다. 각 점을 무작위로 선택된 몇 개의 다른 점들로부터 밀어내는 방식입니다.
3. 초기 방법들과 달리, UMAP의 '힘' 계산은 올바른 점들을 함께 당기는 것과 잘못된 점들을 밀어내는 것 모두에 거의 동등한 중요성을 부여합니다. 이 균형 잡힌 접근 방식은 깨끗하고 잘 분리된 군집을 만드는 핵심입니다.
4. **최적의 지도 완성** 이 인력과 척력이 서로 균형을 이루는 지점, 즉 시스템 전체가 안정될 때까지 점들을 계속해서 움직입니다. 수많은 반복을 통해 점들이 제자리를 찾아가면, 마침내 최종 배치가 완성됩니다. 이것이 바로 UMAP이 만들어낸 최종 지도입니다.
5. 이 과정의 수학적 목표는 1단계에서 만든 '위상 지도'와 2단계에서 만들어지는 '실제 지도' 사이의 정보량 차이, 즉 **교차 엔트로피(Cross Entropy)**를 최소화하는 것입니다.

## 5. UMAP vs. t-SNE: 무엇이 다른가?

UMAP과 t-SNE는 둘 다 뛰어난 시각화 도구이지만, 핵심 철학과 성능에서 중요한 차이가 있습니다.

|특징	|UMAP (Uniform Manifold Approximation and Projection)	|t-SNE (t-Distributed Stochastic Neighbor Embedding) |
|---|---|---|
|**핵심 철학**	|데이터의 **위상(Topology) 구조**, 즉 '연결 관계' 자체를 보존하는 데 집중합니다.<br>(수학적 목표: **Cross-Entropy** 최소화)	|각 점들 사이의 유사도를 <b>'확률 분포'</b>로 보고, 두 확률 분포의 차이를 최소화하려 합니다.<br>(수학적 목표: **KL-Divergence** 최소화)|
|**구조 보존**	|지역적 구조(Local Structure)를 잘 보존하면서도, 데이터 **전체의 큰 그림(Global Structure)을 t-SNE보다 더 잘 유지**하는 경향이 있습니다.	|군집 내부의 미세한 지역적 구조를 표현하는 데 매우 뛰어나지만, 군집 간의 전역적 관계는 왜곡될 수 있습니다.|
|**성능**	|**실행 속도가 매우 빠르고**, 대용량 데이터 및 고차원 임베딩에 대한 확장성이 뛰어납니다.	|데이터가 커질수록 계산량이 기하급수적으로 늘어나며, UMAP에 비해 **실행 속도가 현저히 느립니다.**|

UMAP이 전역 구조를 더 잘 보존하는 능력은 단순히 교차 엔트로피라는 목적 함수가 힘의 균형을 더 잘 맞추기 때문만은 아닙니다. 앞서 언급했듯, 스펙트럼 임베딩(라플라시안 고유맵)을 통한 영리한 초기화 과정이 큰 그림을 유지하는 데 결정적인 역할을 합니다. 이처럼 UMAP의 강점은 현명한 이론적 선택들이 시너지를 내어 만들어진 결과물입니다.

## 6. 핵심 요약: UMAP을 기억하는 세 가지 키워드

지금까지의 내용을 바탕으로, UMAP에 대해 반드시 기억해야 할 세 가지 핵심 포인트를 정리하면 다음과 같습니다.

1. **데이터 지도 제작자** UMAP의 본질은 고차원 데이터의 복잡한 '관계망(위상)'을 저차원의 '지도'로 시각화하는 도구입니다.
2. **유연한 관계망** 점들의 관계를 '연결됨/안됨'이 아닌 '연결될 확률'로 유연하게 정의하여 데이터의 미묘한 구조까지 포착합니다.
3. **빠른 속도**, 뛰어난 균형 t-SNE보다 훨씬 빠를 뿐만 아니라, 그 기반이 되는 수학 원리가 데이터의 세밀한 부분(지역 구조)과 전체적인 큰 그림(전역 구조) 사이의 균형을 더 잘 잡아줍니다.
