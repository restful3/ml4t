이 QuantConnect 프로젝트의 `main.py`와 `universe.py` 파일을 분석해드리겠습니다. 먼저 두 파일을 읽어보겠습니다.


[2 tools called]

이제 두 파일을 분석해서 설명드리겠습니다.

## 프로젝트 개요

이 프로젝트는 **위상 데이터 분석(Topological Data Analysis, TDA)**을 사용하여 포트폴리오를 구성하는 QuantConnect 알고리즘입니다. SPY ETF의 구성종목들을 대상으로 위상학적 그래프를 구축하고 클러스터링하여 포트폴리오를 만드는 방식입니다.

## main.py 분석

### 주요 구성 요소:

1. **알고리즘 클래스**: `TopologicalPortfolio(QCAlgorithm)`
   - QuantConnect의 기본 알고리즘 클래스를 상속

2. **초기화 설정** (`initialize` 메서드):
   - **기간**: 2020년 3월 25일 ~ 2025년 3월 25일
   - **초기 자본**: $1,000,000
   - **벤치마크**: SPY ETF
   - **히스토리 룩백**: 150일 (기본값)
   - **재보정 주기**: 125일 (기본값)

3. **유니버스 선택**:
   - `TopologicalGraphUniverseSelectionModel`을 사용하여 SPY 구성종목들을 선택
   - 상위 200개 종목을 가중치 순으로 필터링

4. **리밸런싱**:
   - 매일 오전 9:31에 실행
   - 클러스터링된 종목들에 대해 가중치를 계산하여 포트폴리오 재구성

5. **가중치 분배 로직** (`weight_distribution` 메서드):
   - 계층적 클러스터 구조를 고려한 가중치 할당
   - 거대 클러스터와 작은 클러스터 간, 그리고 클러스터 내부에서의 가중치 분배
   - 아웃라이어는 투자하지 않음

## universe.py 분석

### 주요 구성 요소:

1. **클래스**: `TopologicalGraphUniverseSelectionModel(ETFConstituentsUniverseSelectionModel)`
   - QuantConnect의 ETF 구성종목 유니버스 선택 모델을 상속

2. **핵심 메서드들**:

   **`construct_simplicial_complex`**:
   - **데이터 수집**: 지정된 룩백 기간의 일별 가격 데이터 수집
   - **로그 수익률 계산**: 일별 로그 수익률을 계산하여 주식 간 관계 분석
   - **차원 축소**: 
     - PCA (80% 분산 유지)
     - UMAP (비선형 관계 처리)
   - **클러스터링**: DBSCAN을 사용하여 상관관계 기반 클러스터링
   - **그래프 구축**: Kepler Mapper를 사용하여 위상학적 그래프 생성

   **`clustering_symbols`**:
   - 연결된 클러스터들을 식별
   - 각 클러스터를 거대 클러스터로 그룹화
   - 노드를 실제 종목 심볼로 변환

3. **사용된 라이브러리**:
   - **kmapper**: 위상학적 데이터 분석
   - **sklearn**: PCA, DBSCAN 클러스터링
   - **umap**: 차원 축소

## 알고리즘의 핵심 아이디어

1. **위상학적 접근**: 주식 간의 관계를 위상학적 그래프로 모델링
2. **다중 차원 축소**: PCA와 UMAP을 조합하여 선형/비선형 관계 모두 포착
3. **노이즈 처리**: DBSCAN을 사용하여 아웃라이어를 효과적으로 처리
4. **계층적 가중치**: 클러스터 구조를 고려한 지능적인 가중치 분배

이 알고리즘은 전통적인 포트폴리오 구성 방법과 달리, 주식 간의 복잡한 위상학적 관계를 분석하여 더 정교한 포트폴리오를 구성하는 혁신적인 접근법을 사용합니다.